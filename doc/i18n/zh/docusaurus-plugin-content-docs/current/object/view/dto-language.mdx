---
sidebar_position: 1
title: ğŸ”¥ DTOè¯­è¨€
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import { ShortAssociation } from '@site/src/components/ShortAssociation';
import FlatProblem from './_flat-problem.md';
import { ViewMore } from '@site/src/components/ViewMore';

## 1. æ¦‚å¿µ

### 1.1. ç—›ç‚¹

Jimmeræä¾›åŠ¨æ€å®ä½“ï¼Œå¯ä»¥å¾ˆå¥½åœ°è§£å†³å¾ˆå¤§ä¸€éƒ¨åˆ†DTOçˆ†ç‚¸é—®é¢˜ã€‚æ‰€ä»¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦å®šä¹‰è¾“å‡ºå‹çš„DTOç±»å‹æ¥è¡¨è¾¾æŸ¥è¯¢è¿”å›ç»“æœã€‚

ç„¶è€Œï¼Œå¹¶éæ‰€æœ‰DTOç±»å‹éƒ½å¯ä»¥è¢«æ¶ˆç­ï¼Œå…¶ä¸­ï¼Œè¾“å…¥å‹çš„DTOå¯¹è±¡å¾ˆéš¾å»é™¤ã€‚

>   ä»¥GraphQLä¸ºä¾‹ï¼Œè™½ç„¶ä»outputçš„è§’åº¦è®²ï¼Œä¸ºå®¢æˆ·ç«¯è¿”å›åŠ¨æ€çš„`GraphQLObject`æ•°æ®ï¼›ä½†æ˜¯ï¼Œä»inputçš„è§’åº¦è®²ï¼Œæ¥å—å®¢æˆ·ç«¯æäº¤çš„é™æ€çš„`GraphQLInput`æ•°æ®ã€‚
>   
>   GraphQLåè®®ä¸ºä»€ä¹ˆå°†`GraphQLInput`å®šä¹‰ä¸ºé™æ€ç±»å‹å‘¢ï¼Ÿæ˜¯å› ä¸ºAPIçš„æ˜ç¡®æ€§å’Œç³»ç»Ÿçš„å®‰å…¨æ€§æ˜¯éå¸¸é‡è¦éœ€æ±‚ï¼Œè¯·å‚è€ƒ[åŠ¨æ€å¯¹è±¡ä½œä¸ºè¾“å…¥å‚æ•°çš„é—®é¢˜](../../mutation/save-command/input-dto/problem)ã€‚
>
>   GraphQLåè®®é¢å¯¹çš„é—®é¢˜ï¼ŒJimmerä¹ŸåŒæ ·éœ€è¦é¢å¯¹ï¼Œå¿…é¡»ç»™å‡ºå®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚

:::tip
DTOè¯­è¨€æ˜¯ä¸ºäº†æ— æ³•è¢«æ¶ˆç­çš„é‚£éƒ¨åˆ†DTOç±»å‹è€Œè®¾è®¡ï¼Œç›®çš„æ˜¯ä¸ºäº†å®ƒä»¬å˜å¾—æå…¶å»‰ä»·ã€‚
:::

### 1.2. æ–¹æ¡ˆ

ä½œä¸ºä¸€ä¸ªç»¼åˆæ€§è§£å†³æ–¹æ¡ˆï¼ŒJimmerä¸å±€é™äºORMæœ¬èº«ï¼Œè€Œæ˜¯ä¸ºæ•´ä¸ªé¡¹ç›®çš„è€ƒè™‘ï¼Œä¸ºè§£å†³æ­¤é—®é¢˜ï¼Œæä¾›äº†DTOè¯­è¨€ã€‚

DTOè¯­è¨€æ˜¯Jimmeræä¾›çš„ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œæ˜¯ä¸€ä¸ªå’Œ[å¯¹è±¡æŠ“å–å™¨](../../query/object-fetcher)é«˜åº¦ç±»ä¼¼çš„æ¦‚å¿µï¼Œä½†åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ä½äºæ›´æ—©çš„é˜¶æ®µã€‚

DTOè¯­è¨€ç”¨äºå¿«é€Ÿå®šä¹‰æ•°æ®ç»“æ„çš„å½¢çŠ¶ï¼Œæ ¹æ®è¿™äº›å½¢çŠ¶ï¼ŒDTOå¯ä»¥åœ¨ç¼–è¯‘æ—¶

-   ç”Ÿæˆç‰¹å®šæ•°æ®ç»“æ„æ‰€å¯¹åº”çš„é™æ€DTOç±»å‹

-   ç”ŸæˆDTOé™æ€å¯¹è±¡å’ŒJimmeråŠ¨æ€å¯¹è±¡ä¹‹é—´çš„ç›¸äº’è½¬æ¢é€»è¾‘

-   ç”Ÿæˆä¸DTOå½¢çŠ¶å®šä¹‰å®Œå…¨å¥‘åˆçš„[å¯¹è±¡æŠ“å–å™¨](../../query/object-fetcher)

ä½¿ç”¨DTOè¯­è¨€å¿«é€Ÿæ„å»ºDTOç±»å‹ï¼Œæ˜¯ä¸ºJimmeré‡èº«è®¾è®¡çš„æ–¹æ¡ˆï¼Œå¼€å‘æ•ˆç‡æé«˜ï¼Œè¿œå¿«äºä½¿ç”¨[mapstruct](./mapstruct)ï¼Œæ˜¯ä¼˜å…ˆæ¨èçš„æ–¹å¼ã€‚

### 1.3. åº”ç”¨åœºæ™¯

DTOè¯­è¨€çš„åº”ç”¨åœºæ™¯

-   [åœ¨æŸ¥è¯¢APIä¸­å……å½“è¿”å›ç»“æœ *(å¯é€‰ï¼Œä¸æ¨èï¼Œéå¿…è¦ä¸ç”¨)*](../../query/object-fetcher/dto)

-   [åœ¨ä¿å­˜APIä¸­å……å½“è¾“å…¥å‚æ•° *(å¿…é¡»)*](../../mutation/save-command/input-dto/dto-lang)

-   [åœ¨è¶…çº§QBEæŸ¥è¯¢ä¸­ä½œä¸ºè¾“å…¥å‚æ•° *(å¯é€‰ï¼Œå»ºè®®ä½¿ç”¨)*](../../query/super_qbe)

## 2. åˆ›å»ºæ–‡ä»¶

DTOè¯­è¨€çš„ä»£ç ä½“ç°ä¸ºæ‰©å±•åä¸º`dto`çš„æ–‡ä»¶ï¼Œä¸€æ—¦ç¼–è¯‘å®Œæˆï¼Œè¿™äº›æ–‡ä»¶å°±æ²¡æœ‰ä»·å€¼äº†ã€‚æ‰€ä»¥ï¼Œè¿™äº›æ–‡ä»¶ä¸èƒ½æ”¾åˆ°`src/main/resources`ä¸­æ‰“åŒ…ï¼Œè€Œæ˜¯æ”¾åˆ°`src/main/dto`ç›®å½•ä¸­ã€‚

å› æ­¤ï¼Œç¬¬ä¸€ä»¶äº‹ï¼Œæ˜¯åœ¨`src/main`ä¸‹å»ºç«‹`dto`å­ç›®å½•ã€‚

:::tip
Jimmerä¸è¦æ±‚`src/main/dto`ç›®å½•å¿…é¡»åœ¨å®ä½“ç±»å‹æ‰€åœ¨çš„é¡¹ç›®ä¸­ã€‚äº‹å®ä¸Šï¼Œä½ å¯ä»¥åœ¨ä»»ä½•èƒ½åˆæ³•è®¿é—®å®ä½“çš„é¡¹ç›®ä¸­å®šä¹‰åˆ›å»ºæ­¤ç›®å½•ã€‚

Jimmeråªè¦æ±‚åœ¨åŒ…å«dtoæ–‡ä»¶çš„é¡¹ç›®ä¸­ä½¿ç”¨`jimmer-apt`æˆ–`jimmer-ksp`ï¼Œå®ƒä»¬è´Ÿè´£DTOæ–‡ä»¶çš„ç¼–è¯‘å’Œç›¸å…³ä»£ç çš„ç”Ÿæˆã€‚

> å¯¹äºJavaé¡¹ç›®è€Œè¨€ï¼Œé™¤äº†`jimmer-apt`å¤–ï¼Œæœ‰å¯èƒ½è¿˜è¿˜éœ€è¦å¤šä¸€ä¸ªé¢å¤–çš„é…ç½®ï¼Œè¯·å‚è§[æ³¨æ„äº‹é¡¹](#22-æ³¨æ„äº‹é¡¹)
:::

### 2.1. ä¸¤ç§åˆ›å»ºæ–‡ä»¶çš„æ–¹æ³•

`src/main/dto`ç›®å½•ä¸‹å¯ä»¥å®šä¹‰è‹¥å¹²ä¸ªdtoæ–‡ä»¶ï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶å’Œä¸€ä¸ªåŸå§‹å®ä½“ç›¸äº’å¯¹åº”ã€‚

å‡è®¾å­˜åœ¨ä¸€ä¸ªJimmerå®ä½“ç±»å‹ï¼Œå…¶å®Œæ•´çš„ç±»å‹åä¸º`com.yourcompany.yourproject.Book`ï¼Œè¯¥ç±»è¢«`@org.babyfish.jimmer.sql.Entity`ä¿®é¥° *(DTOè¯­è¨€åªæ”¯æŒEntityç±»å‹)*ï¼Œ
æœ‰ä¸¤ç§æ–¹æ³•å»ºç«‹dtoæ–‡ä»¶ã€‚

1.  ä¸ä½¿ç”¨`export`è¯­å¥

    è¿™ç§æƒ…å†µä¸‹ï¼Œdtoæ–‡ä»¶çš„ç›®å½•éœ€è¦å’ŒåŸå§‹å®ä½“çš„åŒ…å¯¹åº”ï¼Œåç§°éœ€è¦å’ŒåŸå§‹å®ä½“çš„åç§°å¯¹åº”ï¼š

    1.  åœ¨`src/main/dto`ç›®å½•ä¸‹å»ºç«‹ç›®å½•`com/yourcompany/yourproject`ï¼Œå³ï¼Œå»ºç«‹å’ŒåŒ…åä¸€è‡´çš„ç›®å½•

    2.  åœ¨ä¸Šä¸€æ­¥å»ºç«‹çš„ç›®å½•ä¸­æ–°æ–‡ä»¶`Book.dto`ï¼Œè¯¥æ–‡ä»¶å¿…é¡»å’Œç±»åŒåï¼Œä¸”æ‰©å±•åä¸º`dto`

2.  ä½¿ç”¨`export`è¯­å¥

    è¿™ç§æƒ…å†µä¸‹ï¼Œdtoæ–‡ä»¶ç›®å½•å’Œåç§°æ˜¯éšæ„çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¼šåœ¨æ–‡ä»¶å†…éƒ¨ä½¿ç”¨`export`è¯­å¥å®šä¹‰dtoæ–‡ä»¶å’Œå“ªä¸ªåŸå§‹å®ä½“å¯¹åº”ã€‚

    -   ç”±äºå¯¹dtoæ–‡ä»¶çš„ç›®å½•æ²¡æœ‰è¦æ±‚ï¼Œå»ºè®®ç›´æ¥åœ¨`src/main/dto`ä¸‹å»ºç«‹dtoæ–‡ä»¶

    -   è™½ç„¶å¯¹dtoæ–‡ä»¶çš„åç§°ä¹Ÿæ²¡æœ‰è¦æ±‚ï¼Œä½†æ˜¯ä¸ºäº†é¡¹ç›®çš„å¯ç»´æŠ¤æ€§ï¼Œä»ç„¶å»ºè®®æ–‡ä»¶åé‡‡ç”¨åŸå§‹å®ä½“çš„åç§°ï¼Œè¿™é‡Œï¼Œå°±æ˜¯`Book.dto`

    -   dtoæ–‡ä»¶çš„ç¬¬ä¸€è¡Œä»£ç ä¸º`export`è¯­å¥

        ```sh
        export com.yourcompany.yourproject.Book

        ...åç»­ä»£ç ...
        ```

DTOæ–‡ä»¶è¢«ç¼–è¯‘åï¼Œå°†è‡ªåŠ¨ç”Ÿæˆæ›´å¤šçš„Java/Kotlinç±»å‹ï¼Œå®ƒä»¬é»˜è®¤çš„åŒ…åä¸ºï¼š`å®ä½“åŒ…å` + `.dto`ã€‚

å¦‚æœä½ ä½¿ç”¨äº†`export`è¯­å¥ï¼Œä½ å¯ä»¥è¿›ä¸€æ­¥å®šä¹‰ç”Ÿæˆçš„ä»£ç æ‰€åœ¨çš„åŒ…ï¼Œä¾‹å¦‚ï¼š

```sh
export com.yourcompany.yourproject.Book
    -> package com.yourcompany.yourproject.mydto
```

ç”¨æˆ·å¯ä»¥ç¼–è¾‘`Book.dto`æ–‡ä»¶ï¼Œå®šä¹‰ä»»æ„ä¸ªä»¥`Book`ç±»å‹ä¸ºèšåˆæ ¹çš„æ‰€æœ‰DTOç±»å‹ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆå®šä¸€ä¸ªDTOç±»å‹ï¼š

```sh title="Book.dto"
...çœç•¥export(å¦‚æœæœ‰çš„è¯)...

BookView {
    ...ç•¥...
}
```

:::info
DTOæ–‡ä»¶çš„ç¬¬ä¸€è¡Œä»£ç å¯èƒ½æ˜¯`export`è¯­å¥ï¼Œä¸ºç®€åŒ–æœ¬æ–‡ï¼Œåæ–‡ä¸å†å†™å‡ºã€‚
:::

ç¼–è¯‘åä¼šç”ŸæˆJava/Kotlinç±»å‹`BookView`ï¼Œå‡è®¾ç”Ÿæˆä»£ç æ‰€åœ¨åŒ…çš„é»˜è®¤å€¼æ²¡æœ‰åˆ«ä¿®æ”¹ï¼Œç”Ÿæˆä»£ç å¦‚ä¸‹

<Tabs groupId="language">
<TabItem value="java" label="Java">

```java title="BookView.java"
package com.yourcompany.yourproject.dto;

import com.yourcompany.yourproject.Book;
import org.babyfish.jimmer.View;

public class BookView implements View<Book> {
    ...ç•¥...
}
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin title="BookView.kt"
package com.yourcompany.yourproject.dto

import com.yourcompany.yourproject.Book
import org.babyfish.jimmer.View

data class BookView(
    ...ç•¥...
) : View<Book> {
    ...ç•¥...
} 
```

</TabItem>
</Tabs>

### 2.2. æ³¨æ„äº‹é¡¹

:::warning
-   å¯¹äºJavaé¡¹ç›®è€Œè¨€ *(kotlinå¼€å‘è€…è¯·å¿½ç•¥)*ï¼š

    å¦‚æœå½“å‰é¡¹ç›®å¹¶éå®šä¹‰å®ä½“çš„é¡¹ç›®ï¼Œåˆ™éœ€è¦åœ¨å½“å‰é¡¹ç›®éšæ„æ‰¾ä¸€ä¸ªç±»ï¼Œç”¨`@org.babyfish.jimmer.sql.EnableDtoGeneration`ä¿®é¥°ã€‚

    å¦åˆ™ï¼ŒDTOæ–‡ä»¶ä¸ä¼šè¢«ç¼–è¯‘ã€‚

-   dtoæ–‡ä»¶ç”±Jimmerçš„Annotation Processor *(Java)* æˆ– Ksp *(Kotlin)* ç¼–è¯‘ã€‚

    å› æ­¤ï¼Œå¦‚æœæ­£åœ¨ä½¿ç”¨è¯¸å¦‚Intellijè¿™æ ·çš„IDEå¼€å‘é¡¹ç›®ï¼Œé‚£ä¹ˆ
    
    -   å¦‚æœé™¤äº†dtoæ–‡ä»¶å¤–è¿˜æœ‰å…¶ä»–Java/Kotlinæ–‡ä»¶è¢«ä¿®æ”¹äº†ï¼Œç›´æ¥ç‚¹å‡»IDEä¸­è¿è¡ŒæŒ‰é’®å¯ä»¥å¯¼è‡´dtoæ–‡ä»¶çš„é‡æ–°ç¼–è¯‘

    -   ä½†æ˜¯ï¼Œå¦‚æœé™¤äº†dtoæ–‡ä»¶å¤–æ²¡æœ‰å…¶ä»–Java/Kotlinæ–‡ä»¶è¢«ä¿®æ”¹ï¼Œç®€å•åœ°ç‚¹å‡»IDEä¸­è¿è¡ŒæŒ‰é’®å¹¶ä¸ä¼šå¯¼è‡´dtoæ–‡ä»¶è¢«é‡æ–°ç¼–è¯‘ï¼Œé™¤éæ˜¾å¼åœ°rebuildï¼
:::

## 3. viewã€inputå’Œspecification

å‰æ–‡æåˆ°ï¼ŒDTOè¯­è¨€æœ‰ä¸‰ç§ä½¿ç”¨åœºæ™¯

-   [åœ¨æŸ¥è¯¢APIä¸­å……å½“è¿”å›å€¼ *(å¯é€‰ï¼Œä¸æ¨èï¼Œéå¿…è¦ä¸ç”¨)*](../../query/object-fetcher/dto)

-   [åœ¨ä¿å­˜APIä¸­å……å½“è¾“å…¥å‚æ•° *(å¿…é¡»)*](../../mutation/save-command/input-dto/dto-lang)

-   [åœ¨è¶…çº§QBEæŸ¥è¯¢ä¸­ä½œä¸ºè¾“å…¥å‚æ•° *(å¯é€‰ï¼Œå»ºè®®ä½¿ç”¨)*](../../query/super_qbe)

æ‰€ä»¥ï¼ŒDTOè¯­è¨€å¯ä»¥å®šä¹‰ä¸‰ç§DTO

-   view: æ—¢ä¸ä½¿ç”¨`input`å…³é”®å­—ä¹Ÿä¸ä½¿ç”¨`specification`å…³é”®å­—ï¼Œå¯ä»¥è¢«ç†è§£ä¸ºOutput DTOã€‚

-   input: ä½¿ç”¨`input`å…³é”®å­—å£°æ˜ï¼Œå¯ä»¥è¢«ç†è§£ä¸ºInput DTOã€‚

-   specification: ä½¿ç”¨`specification`å…³é”®å­—å£°æ˜ï¼Œæœ¬èº«å’ŒDTOå…³ç³»ä¸å¤Ÿå¤§ï¼Œä½†å¯ä»¥ç”¨äºåšæŸ¥è¯¢å‚æ•°ï¼Œæ”¯æŒ[è¶…çº§QBEæŸ¥è¯¢](../../query/super_qbe)ã€‚

```sh title="Book.dto"
BookView {
    ...ç•¥...
}

AnotherBookView {
    ...ç•¥...
}

input BookInput {
    ...ç•¥...
}

input AnotherBookInput {
    ...ç•¥...
}

specification BookSpecification {
    ...ç•¥...
}

specification AnotherBookSpecification {
    ...ç•¥...
}
```

è¿™è¡¨ç¤º

-   `BookView`å’Œ`AnotherBookView`ç”¨ä½œæŸ¥è¯¢è¾“å‡ºï¼Œç”Ÿæˆçš„Java/Kotlinç±»å‹ä¼šå®ç°`org.babyfish.jimmer.View<E>`æ¥å£

    :::note
    å»ºè®®è¾“å‡ºDTOä»¥`View`ç»“å°¾
    :::

-   `BookInput`å’Œ`AnotherBookInput`ç”¨ä½œä¿å­˜æŒ‡ä»¤è¾“å…¥ï¼Œç”Ÿæˆçš„Java/Kotlinç±»å‹ä¼šå®ç°`org.babyfish.jimmer.Input<E>`æ¥å£

    :::note
    å»ºè®®è¾“å…¥DTOä»¥`Input`ç»“å°¾
    :::

-   `BookSpecification`å’Œ`AnotherBookSpecification`ç”¨ä½œæŸ¥è¯¢å‚æ•°ï¼Œç”Ÿæˆçš„Java/Kotlinç±»å‹ä¼šå®ç°`org.babyfish.jimmer.Specification<E>`æ¥å£

    :::note
    å»ºè®®æŸ¥è¯¢å‚æ•°DTOä»¥`Specification`ç»“å°¾
    :::

### 3.1 viewå’Œinputå…±æœ‰çš„åŠŸèƒ½

å¯¹äºviewå’Œinputè€Œè¨€ï¼Œå…¶ç”Ÿæˆçš„Java/Kotlinç±»å‹å¯ä»¥å’Œå®ä½“ç›¸äº’è½¬åŒ–ï¼Œå…·å¤‡å¦‚ä¸‹åŠŸèƒ½

-   ä»¥åŸå§‹å®ä½“ç±»å‹ä¸ºå‚æ•°çš„æ„é€ æ–¹æ³•ï¼šå°†JimmeråŠ¨æ€å®ä½“å¯¹è±¡è½¬åŒ–ä¸ºé™æ€DTOå¯¹è±¡

-   `toEntity()`ï¼šå°†é™æ€DTOå¯¹è±¡è½¬åŒ–ä¸ºJimmeråŠ¨æ€å®ä½“å¯¹è±¡

ä»¥`BookView`ä¸ºä¾‹

<Tabs groupId="language">
<TabItem value="java" label="Java">

```java
Book entity = ...ç•¥...

// å®ä½“ -> DTO
BookView dto = new BookView(entity);

// DTO -> å®ä½“
Book anotherEntity = dto.toEntity();
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin
val entity: Book = ...ç•¥...

// å®ä½“ -> DTO
val dto = BookView(entity)

// DTO -> å®ä½“
val anotherEntity: Book = dto.toEntity()
```

</TabItem>
</Tabs>

### 3.2 inputç‰¹æœ‰åŠŸèƒ½

å’ŒOutput DTOç›¸æ¯”ï¼ŒInput DTOå­˜åœ¨å¦‚ä¸‹ä¸åŒ

-   å¦‚æœå®ä½“idå±æ€§é…ç½®äº†è‡ªåŠ¨å¢é•¿ç­–ç•¥ï¼Œé‚£ä¹ˆinput DTOä¸­çš„idå±æ€§æ˜¯nullableçš„ã€‚

-   input DTOä¸­åªèƒ½å®šä¹‰å¯ä»¥ä¿å­˜çš„å±æ€§ï¼Œå¦‚ç®€å•å±æ€§ã€æ™®é€šORMå…³è”å±æ€§å’Œid-viewå±æ€§ã€‚ ä¸èƒ½å®šä¹‰æ— æ³•ä¿å­˜çš„å±æ€§ï¼Œå¦‚transientå±æ€§ã€å…¬å¼å±æ€§ã€è®¡ç®—å±æ€§å’Œè¿œç¨‹å…³è”ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚

### 3.3 specificationç‰¹æœ‰åŠŸèƒ½

`specification`å’Œ`input`çš„ä½œç”¨ç±»ä¼¼ï¼Œç”¨äºä¿®é¥°è¾“å…¥ç±»å‹ï¼Œä½†`specification`ä¸æä¾›å’Œå®ä½“å¯¹è±¡ç›¸äº’è½¬åŒ–çš„èƒ½åŠ›ï¼Œè€Œæ˜¯è¢«ç”¨ä½œæ”¯æŒ[è¶…çº§QBEæŸ¥è¯¢](../../query/super_qbe)ã€‚

:::tip
[è¶…çº§QBEæŸ¥è¯¢](../../query/super_qbe)æ˜¯Jimmerçš„ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œæœ¬æ–‡ä¸åšé˜è¿°ï¼Œè¯·å‚è§[ç›¸å…³ç« èŠ‚](../../query/super_qbe)ã€‚
:::

## 4. ç®€å•å±æ€§

å¯ä»¥ä¸ºDTOç±»å‹å±æ€§ï¼Œç”¨äºæ˜ å°„åŸå§‹å®ä½“ç±»å‹ä¸­å±æ€§ï¼Œä¾‹å¦‚

```sh title="Book.dto"
BookView {
    id
    name 
    edition
}
```

è¿™è¡¨ç¤ºï¼ŒDTOåªæ˜ å°„å®ä½“ä¸­çš„ä¸‰ä¸ªå±æ€§ï¼š`id`ã€`name`å’Œ`edition`ï¼Œå¦‚ä¸‹

<Tabs groupId="language">
<TabItem value="java" label="Java">

```java title="BookView.java"
public class BookView implements View<Book> {

    private long id;
    private String name;
    private String edition;

    public BookView(Book book) {
        ...ç•¥...
    }

    @Override
    public Book toEntity() {
        ...ç•¥...
    }

    ...çœç•¥å…¶ä»–æˆå‘˜...
}
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin title="BookView.kt"
data class BookView(
    val id: Long = 0,
    val name: String = "",
    val edition: Int = 0
) : View<Book> {

    constructor(book: Book): this(...ç•¥...)

    override fun toEntity(): Book {
        ...ç•¥...
    }

    ...çœç•¥å…¶ä»–æˆå‘˜...
} 
```

</TabItem>
</Tabs>

## 5. allScalars

DTOè¯­è¨€æ”¯æŒä¸€ä¸ªç‰¹åˆ«çš„å®å±æ€§ï¼Œ`#allScalars`ï¼Œè¡¨ç¤ºæ˜ å°„å®ä½“ä¸­çš„æ‰€æœ‰æ ‡é‡å±æ€§

```sh title="Book.dto"
BookView {
    #allScalars
}
```

æŒ‰ç…§å®˜æ–¹ä¾‹å­ä¸­`Book`ç±»å‹çš„å®šä¹‰

-   `Book`æœ¬èº«çš„æ ‡é‡å±æ€§æœ‰`id`ã€`name`ã€`edition`å’Œ`price`

-   `Book`ç»§æ‰¿äº†`TenantAware`ï¼Œ`TenantAware`æ¥å£å®šä¹‰äº†å±æ€§`tenant`

-   `Book`ä¹Ÿç»§æ‰¿äº†`CommonEntity` *(å¤šç»§æ‰¿)*ï¼Œ`CommonEntity`æ¥å£å®šä¹‰äº†å±æ€§`createdTime`å’Œ`modifiedTime`

`#allScalars`è¡¨ç¤ºè‡ªåŠ¨æ˜ å°„å®ä½“æ‰€æœ‰æ ‡é‡å±æ€§ï¼ŒåŒ…æ‹¬ç»§æ‰¿çš„ã€‚

å¦‚æœè¿™ä¸æ˜¯ä½ æ‰€è¦çš„è¡Œä¸ºï¼Œé‚£ä¹ˆ

-   å¯ä»¥ä½¿ç”¨`allScalars(Book)`ï¼Œè¡¨ç¤ºåªæ˜ å°„Bookç±»å‹æœ¬èº«å®šä¹‰çš„æ‰€æœ‰æ ‡é‡å±æ€§ï¼Œä¸åŒ…å«ç»§æ‰¿çš„å±æ€§ã€‚

-   ä¹Ÿå¯ä»¥ä½¿ç”¨`allScalars(TenantAware)`å’Œ`allScalars(CommonEntity)`è¡¨ç¤ºç‰¹å®šè¶…ç±»å‹çš„å±æ€§ã€‚

:::tip
å¯¹äºå½“å‰ç±»å‹`Book`è€Œè¨€ï¼Œ#allScalars(Book)ä¹Ÿå¯ä»¥å†™ä½œ`#allScalars(this)`ã€‚
:::

äº‹å®ä¸Šï¼Œ`#allScalars`æ”¯æŒå¤šä¸ªå‚æ•°ï¼Œä¸¾ä¾‹å¦‚ä¸‹

|å®è¡¨è¾¾å¼|è‡ªåŠ¨æ˜ å°„çš„å±æ€§|
|---|---|
|#allScalars|createdTime, modifiedTime, tenant, id, name, edition, price|
|#allScalars(this)|id, name, edition, price|
|#allScalars(TenantAware)|tenant|
|#allScalars(CommonEntity)|createdTimeã€modifiedTime|
|#allScalars(this, TenantAware)|tenant, id, name, edition, price|
|#allScalars(this, CommonEntity)|createdTimeã€modifiedTime, id, name, edition, price|
|#allScalars(TenantAware, CommonEntity)|createdTimeã€modifiedTime, tenant|
|#allScalars(this, TenantAware, CommonEntity)|createdTime, modifiedTime, tenant, id, name, edition, price|

:::info
-   å¦‚æœä½¿ç”¨`#allScalars`å®ï¼Œåˆ™å®ƒå¿…é¡»è¢«å®šä¹‰æˆç¬¬ä¸€ä¸ªå±æ€§ï¼Œå¦åˆ™ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç¼–è¯‘æŠ¥é”™ã€‚

-   å¦‚æœä¸º`#allScalars`å®æŒ‡å®šå‚æ•°ï¼Œåˆ™æ¯ä¸ªå‚æ•°å¿…é¡»ä¸ºå½“å‰å®ä½“æˆ–å…¶åŸºç±»å‹ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç¼–è¯‘æŠ¥é”™ã€‚
:::

## 6. è´Ÿå±æ€§

å‰æ–‡æ‰€è®²çš„`#allScalars`å®ï¼Œä¼šæ‰¹é‡åŒ–åœ°è®©DTOæ˜ å°„å¤šä¸ªå±æ€§ã€‚è´Ÿå±æ€§å¯ä»¥å»æ‰æŸäº›å±æ€§

```sh title="Book.dto"
BookView {
    #allScalars
    // highlight-next-line
    -tenant
}
```

å’Œä¸Šé¢ä¸€æ ·ï¼Œå¦‚æœæŒ‰å®˜æ–¹ä¾‹å­ä¸­`Book`ç±»å‹çš„ç»§æ‰¿å…³ç³»æ¥ç†è§£çš„è¯ï¼Œ`#allScalars`ä¼šåŠ å…¥å±æ€§`createdTime`ã€`modifiedTime`ã€`tenant`ã€`id`ã€`name`ã€`edition`å’Œ`price`ã€‚

è€Œ`-tenant`ä»ä¸­å‡å»äº†`tenant`å±æ€§ï¼Œæœ€ç»ˆåŠ å…¥å±æ€§`createdTime`ã€`modifiedTime`ã€`id`ã€`name`ã€`edition`å’Œ`price`ã€‚

:::info
è´Ÿå±æ€§æŒ‡å®šçš„å…¶å®ä¸æ˜¯å®ä½“å±æ€§åï¼Œè€Œæ˜¯DTOä¸­å¯¹åº”å±æ€§çš„åç§°ï¼Œåœ¨è¿™é‡ŒäºŒè€…ç›¸åŒï¼Œå¹¶æ— å·®å¼‚ã€‚

ç¨åçš„ç« èŠ‚[é‡å‘½å](#8-é‡å‘½å)ä¼šæ­ç¤ºäºŒè€…åŒºåˆ«ã€‚
:::

ä¸éš¾å‘ç°ï¼Œå¯¹äºè¿™ä¸ªä¾‹å­è€Œè¨€ï¼Œè¿˜æœ‰ä¸€ç§ä¸ä¹‹ç­‰ä»·çš„å†™æ³•

```sh title="Book.dto"
BookView {
    // æ’é™¤`TenantAware`
    #allScalars(Book, CommonEntity) 
}
```

## 7. å¯ç©ºæ€§

é»˜è®¤æƒ…å†µä¸‹ï¼Œ

-   `specification`ä¸­æ‰€æœ‰å±æ€§éƒ½é»˜è®¤å¯null

-   å¦åˆ™ï¼ŒDTOå±æ€§çš„å¯ç©ºæ€§å’Œå®ä½“ä¸­åŸå§‹å±æ€§çš„å¯ç©ºæ€§ä¸€æ ·ã€‚

æˆ‘ä»¬å¯ä»¥é‡‡ç”¨é—®å·`?`æˆ–`!`ä¿®é¥°DTOå±æ€§ï¼Œæ”¹å˜DTOå±æ€§çš„å¯ç©ºæ€§ã€‚

### 7.1. `?`

æˆ‘ä»¬å¯ä»¥é‡‡ç”¨`?`ä¿®é¥°DTOå±æ€§ï¼Œè®©å…¶å¯nullã€‚

:::warning
å¦‚æœå®ä½“ä¸­åŸå±æ€§å·²ç»å¯nullï¼Œåˆ™ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯
:::

ä¾‹å¦‚
```sh title="Book.dto"
input UpdateBookInput {
    #allScalars
    // highlight-next-line
    price?
}
```

ä½ ç”šè‡³å¯ä»¥å¯¹`allScalars`é‡‡ç”¨`?`ï¼Œè®©æ‰€æœ‰è‡ªåŠ¨æ˜ å°„çš„éå…³è”å±æ€§å…¨éƒ¨å¯ä»¥ä¸ºnull

```sh title="Book.dto"
input UpdateBookInput {
    // highlight-next-line
    #allScalars?
}
```

-   Specificationç±»å‹ä¸å…è®¸ä½¿ç”¨`?`

    :::warning
    ç”±äº`speciciation`é»˜è®¤æ‰€æœ‰å±æ€§å¯ä»¥ä¸ºnullï¼Œæ‰€ä»¥åœ¨specificationå†…éƒ¨ä¸ºå±æ€§æŒ‡å®šä¿®é¥°ç¬¦`?`å°†ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚
    :::

-   å½“å®ä½“çš„åŸå±æ€§ä¸å…è®¸ä¸ºnullæ—¶

    å¯¹äºå®ä½“ä¸­çš„ä¸å…è®¸ä¸ºnullåŸå§‹å±æ€§è€Œè¨€ï¼Œå¦‚æœDTOå¯¹è±¡çš„å¯¹åº”å±æ€§ä¸ºnullï¼Œé‚£ä¹ˆå°†æ”¹DTOå¯¹è±¡è½¬åŒ–ä¸ºå®ä½“å¯¹è±¡åï¼Œå®ä½“å¯¹è±¡ä¸­åŸå§‹å±æ€§ä¸ä¼šè¢«èµ‹å€¼ã€‚

-   å½“å®ä½“çš„åŸå±æ€§å…è®¸ä¸ºnullæ—¶

    å¯¹äºå®ä½“ä¸­çš„æœ¬å°±å…è®¸ä¸ºnullåŸå§‹å±æ€§è€Œè¨€ï¼Œå¦‚æœDTOå¯¹è±¡çš„å¯¹åº”å±æ€§ä¸ºnullï¼Œé‚£ä¹ˆå°†æ”¹DTOå¯¹è±¡è½¬åŒ–ä¸ºå®ä½“å¯¹è±¡åï¼š

    -   å¦‚æœ`input`ç±»å‹æœªè¢«`dynamic`å…³é”®å­—ä¿®é¥°ï¼Œé‚£ä¹ˆå®ä½“å¯¹è±¡ä¸­åŸå§‹å±æ€§ä¼šè¢«èµ‹ä¸ºnullã€‚

    -   å¦‚æœ`input`ç±»å‹è¢«`dynamic`å…³é”®å­—ä¿®é¥°ï¼Œä¾‹å¦‚

        ```sh title="BookStroe.dto"
        #highlight-next-line
        dynamic input BookInput {
            #allScalars(this)?
        }
        ```

        é‚£ä¹ˆï¼Œå®ä½“å¯¹è±¡ä¸­åŸå§‹å±æ€§ä¸ä¼šè¢«èµ‹å€¼ã€‚

### 7.2. `!`

æˆ‘ä»¬å¯ä»¥é‡‡ç”¨`!`ä¿®é¥°DTOå±æ€§ï¼Œè®©å…¶énullã€‚

:::warning
å¦‚æœå®ä½“ä¸­åŸå±æ€§å·²ç»énullï¼Œåˆ™ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯
:::

å…¶ä½¿ç”¨åœºæ™¯å—é™ï¼Œåªèƒ½ç”¨äºä»¥ä¸‹ä¸‰ç§æƒ…å†µã€‚

-   åœ¨`input`ç±»å‹ä¸­ä¿®é¥°idå±æ€§

    å¦‚æœidå±æ€§è¢«é…ç½®è‡ªåŠ¨å¢é•¿ç­–ç•¥ï¼Œé‚£ä¹ˆå¯¹åº”çš„input DTOç±»å‹å°†ä¼šæŠŠidå±æ€§è®¾ç½®ä¸ºå¯nullã€‚

    ç„¶è€Œï¼Œè¿™ç§è¡Œä¸ºå¹¶ä¸æ€»æ˜¯ç¬¦åˆç”¨æˆ·é¢„æœŸï¼Œå¯ä»¥åœ¨`input`ç±»å‹ä¸­ä½¿ç”¨`!`ä¿®é¥°idå±æ€§ï¼Œè®©å…¶énullï¼Œä¾‹å¦‚

    ```sh  title="Book.dto"
    input BookUpdateInfo {
        #allScalars
        #highlight-next-line
        id!
    }
    ```

    :::warning
    å¦‚æœç”¨`?`ä¿®é¥°å…¶å®ƒå±æ€§ï¼Œå°†ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯
    :::

-   å¦‚æœ`input`è¢«`unsafe`å…³é”®å­—ä¿®é¥°ï¼Œåˆ™å¯ä»¥å°†ä»»ä½•å¯nullçš„å®ä½“å±æ€§è½¬åŒ–ä¸ºénullï¼Œä¾‹å¦‚

    ```sh  title="Book.dto"
    unsafe input BookUpdateInfo {
        #allScalars
        #highlight-next-line
        store! {
            ...ç•¥...
        }
    }
    ```

    :::info
    å¯¹äºä¸€ä¸ªå®ä½“å¯¹è±¡è€Œè¨€ï¼Œå¦‚æœæ”¹å±æ€§å¯¹åº”çš„å€¼ä¸ºnullï¼Œåœ¨ä½¿ç”¨Input DTOçš„æ„é€ æ–¹æ³•å°†å…¶è½¬åŒ–ä¸ºInput DTOå¯¹è±¡æ˜¯ï¼Œç”±äºDTOä¸­å¯¹åº”çš„å±æ€§ä¸å…è®¸ä¸ºnullï¼Œå°†ä¼šå¯¼è‡´ä¸€åœºã€‚

    è¿™å°±æ˜¯`unsafe`å…³é”®å­—çš„æ„ä¹‰ã€‚
    :::

-   å¯¹äº`specification`è€Œè¨€ï¼Œç”±äºæ‰€æœ‰å±æ€§éƒ½è¢«é»˜è®¤ä¸ºnullï¼Œæ‰€ä»¥å¯ä»¥å°†ä»»ä½•å¯nullçš„å®ä½“å±æ€§è½¬åŒ–ä¸ºénullï¼Œä¾‹å¦‚

    ```sh  title="Book.dto"
    specification BookSpecification {
        #allScalars
        #highlight-next-line
        edition!
    }
    ```

## 8. é‡å‘½å

å¯ä»¥ä½¿ç”¨`as`å…³é”®å­—ä¸ºå±æ€§è®¾ç½®åˆ«åï¼Œè®©å®ä½“å±æ€§åå’ŒDTOå±æ€§åä¸åŒã€‚

`as`æœ‰ä¸¤ç§ç”¨æ³•ï¼Œæ—¢å¯ä»¥ç²¾ç¡®åœ°ä¸ºä¸€ä¸ªå±æ€§è®¾ç½®åˆ«åï¼Œä¹Ÿå¯ä»¥æ¨¡ç³Šåœ°ä¸ºå¤šä¸ªå±æ€§è®¾ç½®åˆ«å

### 8.1. é‡å‘½åå•ä¸ªå±æ€§

```sh title="Book.dto"
BookView {
    name as bookName
}
```

### 8.2. é‡å‘½åå¤šä¸ªå±æ€§

å‡è®¾æœ‰ä¸€ä¸ªå®ä½“ç±»å‹å«åš`Robot`

```sh title="Robot.dto"
OrderView {
    as (^ -> oldSystem) { â¶ 
        prop1
        prop2
    }
    as ($ -> ForNewSystem) { â·
        prop3
        prop4
    }
}
```

å…¶ä¸­

-   â¶ ä¸º`prop1`å’Œ`prop2`æ·»åŠ å‰ç¼€`oldSystem`ï¼Œå…¶ä¸­`^`è¡¨ç¤ºèµ·å§‹ä½ç½®

-   â· ä¸º`prop3`å’Œ`prop4`æ·»åŠ åç¼€`ForNewSystem`ï¼Œå…¶ä¸­`$`è¡¨ç¤ºèµ·å§‹ä½ç½®

ç”Ÿæˆçš„`RobotView`ç±»å¦‚ä¸‹

<Tabs groupId="language">
<TabItem value="java" label="Java">

```java title="BookView.java"
public class RobotView implements View<Robot> {

    private String oldSystemProp1;
    private String oldSystemProp2;

    private String prop3ForNewSystem;
    private String prop4ForNewSystem;

    ...çœç•¥å…¶ä»–æˆå‘˜...
}
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin title="BookView.kt"
data class RobotView(
    
    val oldSystemProp1 = "",
    val oldSystemProp2 = "",

    val prop3ForNewSystem = "",
    val prop4ForNewSystem = ""
) : View<Robot> {

    ...çœç•¥å…¶ä»–æˆå‘˜...
} 
```

</TabItem>
</Tabs>

å¯ä»¥åœ¨`as() {...}`å—ä¸­å®šä¹‰ç»å¤§éƒ¨åˆ†å±æ€§ï¼Œå½“ç„¶åŒ…æ‹¬`#allScalars`ï¼Œä¾‹å¦‚

```sh title="Robot.dto"
RobotView {
    # highlight-next-line
    as(^ -> robot) {
        # highlight-next-line
        #allScalars
    }
}
```

ä¸‹é¢ç½—åˆ—`as() {...}`å—çš„æ‰€æœ‰ç”¨æ³•

|ä»£ç ç¤ºèŒƒ|ä½œç”¨æè¿°|
|---|---|
|as(^ -> prefix)|æ·»åŠ å‰ç¼€|
|as(^prefix ->)|åˆ é™¤å‰ç¼€|
|as(^prefix -> newPrefix)|æ›¿æ¢å‰ç¼€|
|as($ -> suffix)|æ·»åŠ åç¼€|
|as($suffix ->)|åˆ é™¤åç¼€|
|as($suffix -> newSuffix)|æ›¿æ¢åç¼€|
|as(infix -> )|åˆ é™¤ä»»ä½•ä½ç½®çš„å†…å®¹|
|as(infix -> newInfix)|æ›¿æ¢ä»»ä½•ä½ç½®çš„å†…å®¹|

:::caution
`^`å’Œ`$`ä¸èƒ½åŒæ—¶å‡ºç°ï¼Œå› ä¸ºè¿™è¡¨ç¤ºç²¾ç¡®é‡å‘½åå•ä¸ªå±æ€§ï¼Œè¿™å’Œå·²æœ‰çš„åŠŸèƒ½é‡å¤
:::

## 9. æšä¸¾æ˜ å°„

é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ä½“çš„æšä¸¾ç±»å‹å±æ€§è¢«æ˜ å°„æˆDTOå±æ€§åä»ç„¶æ˜¯æšä¸¾ç±»å‹ã€‚

ä½ å¯ä»¥å°†æšä¸¾ç±»å‹æ˜ å°„ä¸ºæ•°å­—æˆ–å­—ç¬¦ä¸²ã€‚

-   æ˜ å°„ä¸ºæ•°å­—

    ```sh
    AuthorView {
        #allScalars
        gender -> {
            MALE: 100
            FEMALE: 101
        }
    }
    ```

    ç”Ÿæˆå¦‚ä¸‹ä»£ç 
    <Tabs groupId="language">
    <TabItem value="java" label="Java">

    ```java title="BookView.java"
    public class AuthorView implements View<AuthorView> {

        private int gender;

        ...çœç•¥å…¶ä»–æˆå‘˜...
    }
    ```

    </TabItem>
    <TabItem value="kotlin" label="Kotlin">

    ```kotlin title="BookView.kt"
    data class RobotView(
        val gender: Int,
        ...çœç•¥å…¶ä»–æˆå‘˜...
    ) : View<Robot> {

        ...çœç•¥å…¶ä»–æˆå‘˜...
    } 
    ```

    </TabItem>
    </Tabs>

-   æ˜ å°„ä¸ºå­—ç¬¦ä¸²

    ```sh
    AuthorView {
        #allScalars
        gender -> {
            MALE: "Male"
            FEMALE: "Female"
        }
    }
    ```

    ç”Ÿæˆå¦‚ä¸‹ä»£ç 
    <Tabs groupId="language">
    <TabItem value="java" label="Java">

    ```java title="BookView.java"
    public class AuthorView implements View<AuthorView> {

        private String gender;

        ...çœç•¥å…¶ä»–æˆå‘˜...
    }
    ```

    </TabItem>
    <TabItem value="kotlin" label="Kotlin">

    ```kotlin title="BookView.kt"
    data class RobotView(
        val gender: String,
        ...çœç•¥å…¶ä»–æˆå‘˜...
    ) : View<Robot> {

        ...çœç•¥å…¶ä»–æˆå‘˜...
    } 
    ```

    </TabItem>
    </Tabs>

## 10. å…³è”å±æ€§

å¯¹å…³è”å±æ€§çš„å¤„ç†æ˜¯DTOè¯­è¨€ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œå­˜åœ¨ä¸‰ç§ç”¨æ³•

-   ç›´æ¥ä½¿ç”¨
-   é€’å½’å…³è”
-   è°ƒç”¨idå‡½æ•°
-   è°ƒç”¨flatå‡½æ•°

### 10.1. æ™®é€šå…³è”

-   åŸºæœ¬ç”¨æ³•

    ```sh title="Robot.dto"
    input CompositeBookInput {
        
        #allScalars(Book)

        # highlight-next-line
        store {
            #allScalars(BookStore)
            -id
        }

        # highlight-next-line
        authors {
            #allScalars(Author)
            -id
        }
    }
    ```

    ç”Ÿæˆçš„ä»£ç ä¸º

    <Tabs groupId="language">
    <TabItem value="java" label="Java">

    ```java title="CompositeBookInput.java"
    public class CompositeBookInput implements Input<Book> {

        @Nullable
        private Long id;

        private String name;

        private int edition;

        private BigDecimal price;

        // highlight-next-line
        private TargetOf_store store;

        // highlight-next-line
        private List<TargetOf_authors> authors;

        // highlight-next-line
        public static class TargetOf_store implements Input<BookStore> {
        
            private String name;

            @Nullable
            private String website;

            ...çœç•¥å…¶ä»–æˆå‘˜...
        }

        // highlight-next-line
        public static class TargetOf_authors implements Input<Author> {
            
            private String firstName;

            private String lastName;

            private Gender gender;

            ...çœç•¥å…¶ä»–æˆå‘˜...
        }

        ...çœç•¥å…¶ä»–æˆå‘˜...
    }
    ```

    </TabItem>
    <TabItem value="kotlin" label="Kotlin">

    ```kotlin title="CompositeBookInput.kt"
    data class CompositeBookInput(
        val id: Long? = null,
        val name: String = "",
        val edition: Int = 0,
        val price: BigDecimal,

        // highlight-next-line
        val store: TargetOf_store? = null,
        // highlight-next-line
        val authors: List<TargetOf_authors> = emptyList(),
    ) : Input<Book> {

        // highlight-next-line
        data class TargetOf_store(
            val name: String = "",
            val website: String? = null,
        ) : Input<BookStore> {
            ...çœç•¥å…¶ä»–æˆå‘˜...
        }

        // highlight-next-line
        data class TargetOf_authors(
            public val firstName: String = "",
            public val lastName: String = "",
            public val gender: Gender,
        ) : Input<Author> {
            ...çœç•¥å…¶ä»–æˆå‘˜...
        }

        ...çœç•¥å…¶ä»–æˆå‘˜...
    } 
    ```

    </TabItem>
    </Tabs>

-   é‡å‘½å

    å¦‚æœè¦å¯¹å…³è”å±æ€§è¿›è¡Œé‡å‘½åï¼Œ`as`å­å¥åº”è¯¥åœ¨å…³è”å®šä¹‰å—ä¹‹å‰ï¼Œä¾‹å¦‚

    ```sh title="Book.dto"
    input CompositeBookInput {
        
        authors as authorList {
            ...ç•¥...
        }

        ...ç•¥...
    }
    ```

### 10.2 é€’å½’å…³è”

å¯¹äºå®ä½“ä¸­å¯é€’å½’çš„å±æ€§ï¼Œæ¯”å¦‚ï¼Œé™„å¸¦ä¾‹å­ä¸­çš„`TreeNode.parent`æˆ–`TreeNode.childNodes`ï¼Œå¯ä»¥ä½¿ç”¨æ˜Ÿå·`*`å°†DTOå¯¹åº”çš„å…³è”å±æ€§æ ‡è®°ä¸ºé€’å½’å±æ€§ã€‚

```sh title="TreeNode.dto"
TreeNodeView {
    
    #allScalars

    childNodes {
        #allScalars
    #highlight-next-line
    }*
}
```

### 10.3. idå‡½æ•°

å¯¹äº<ViewMore buttonText="çŸ­å…³è”"><ShortAssociation/></ViewMore>è€Œè¨€ï¼Œæˆ‘ä»¬å½“ç„¶é€‰æ‹©åœ¨å®ä½“ä¸­å®šä¹‰[@IdView](../../mapping/advanced/view/id-view)å±æ€§ï¼Œä¾‹å¦‚

<Tabs groupId="language">
<TabItem value="java" label="Java">

```java title="Book.java"
@Entity
public interface Book {

    @Nullable
    @ManyToOne
    BookStore store();

    @ManyToMany
    val authors: List<Author>

    // highlight-next-line
    @IdView
    Long storeId();

    // highlight-next-line
    @IdView("authors")
    List<Long> authorIds();
}
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin title="Book.kt"
@Entity
interface Book {

    @ManyToOne
    val store: BookStore?

    @ManyToMany
    val authors: List<Author>
    
    // highlight-next-line
    @IdView
    val storeId: Long?

    // highlight-next-line
    @IdView("authors")
    val authorIds: List<Long>
} 
```

</TabItem>
</Tabs>

åœ¨å®ä½“å·²ç»å®šä¹‰äº†[@IdView](../../mapping/advanced/view/id-view)å±æ€§çš„æƒ…å†µä¸‹ï¼Œåªéœ€è¦ç”¨DTOè¯­è¨€ç®€å•åœ°å¼•ç”¨å³å¯

```sh title="Book.dto"
BookView {

    // highlight-next-line
    storeId

    // highlight-next-line
    authorIds

    ...ç•¥...
}
```

:::tip
ç„¶è€Œï¼Œæˆ‘ä»¬ä¸èƒ½æ€»æ˜¯å¯„å¸Œæœ›äºå®ä½“ç±»å‹æ€»æ˜¯å£°æ˜äº†[@IdView](../../mapping/advanced/view/id-view)å±æ€§ï¼Œæ›´å¥½çš„æ–¹æ¡ˆä¸åº”è¯¥æœ‰æ­¤å‡è®¾ã€‚

å› æ­¤ï¼ŒDTOè¯­è¨€æ”¯æŒå¯¹å…³è”å±æ€§è°ƒç”¨`id`å‡½æ•°æ¥è¾¾åˆ°åŒæ ·ç›®çš„
:::

```sh title="Book.dto"
BookView {

    // highlight-next-line
    id(store)

    // highlight-next-line
    id(authors) as authorIds

    ...ç•¥...
}
```

è¿™æ®µä»£ç çš„åŠŸèƒ½å’Œå‰é¢çš„ä¾‹å­å®Œå…¨ä¸€æ ·ï¼Œä½†ä¸å†å‡è®¾å®ä½“ç±»å‹æ€»æ˜¯å£°æ˜äº†[@IdView](../../mapping/advanced/view/id-view)å±æ€§ï¼Œæ˜¯æ›´å¥½çš„æ–¹æ¡ˆã€‚

### 10.4. flatå‡½æ•°

-   å¯¹viewå’Œinputè€Œè¨€ï¼Œ`flat`å‡½æ•°åªèƒ½ç”¨äºå¼•ç”¨å…³è” *(ä¸€å¯¹ä¸€æˆ–å¤šå¯¹ä¸€)*ï¼Œä¸èƒ½ç”¨äºé›†åˆå…³è” *(ä¸€å¯¹å¤šæˆ–å¤šå¯¹å¤š)*ï¼Œç”¨äºæŠŠå…³è”DTOçš„å±æ€§æå‡åˆ°å½“å‰DTOç±»å‹ï¼Œå¾—åˆ°ä¸å«å…³è”çš„å¹³å¦å¯¹è±¡ã€‚

-   å¯¹äºsepecificationè€Œè¨€ï¼Œ`flat`å‡½æ•°æ²¡æœ‰ä¸Šè¿°é™åˆ¶ï¼Œå¯ä»¥ç”¨äºé›†åˆå…³è”ã€‚è¯·æŸ¥çœ‹(../../query/super_qbe)ã€‚

ä»¥å®˜æ–¹ä¾‹å­ä¸­çš„`TreeNode`å®ä½“ä¸ºä¾‹ *(äº‹å®ä¸Šï¼Œè¿™ä¸ªä¾‹å­æ˜¯é”™è¯¯çš„ï¼Œæˆ‘ä»¬ç¨åä¼šè®¨è®ºè¿™ä¸ªé—®é¢˜)*

```sh title="TreeNode.dto"
FlatTreeNodeView {
    
    #allScalars(TreeNode)

    # highlight-next-line
    flat(parent) {
        #allScalars(TreeNode)
    }
}
```

å¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œè¿™ä¸ªä¾‹å­æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºèšåˆæ ¹å’Œå…³è”å¯¹è±¡éƒ½æœ‰å±æ€§`id`å’Œ`name`ï¼Œæ— æ¡ä»¶æŠŠå…³è”å¯¹è±¡çš„å±æ€§å¾€èšåˆæ ¹ä¸Šæå–ï¼Œå¿…ç„¶å¯¼è‡´åå­—å†²çªï¼Œæœ€ç»ˆå¯¼è‡´DTOè¯­è¨€ç¼–è¯‘æŠ¥é”™ã€‚

æ­£ç¡®çš„åšæ³•ï¼Œæ˜¯å’Œç”¨æˆ·å¤šå±æ€§æ¨¡ç³Šé‡å‘½åçš„`as(...) {}`å—ç»“åˆä½¿ç”¨ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ–°çš„ä¾‹å­

```sh title="TreeNode.dto"
FlatTreeNodeView {
    
    #allScalars(TreeNode) // id, name

    # highlight-next-line
    flat(parent) {
        # highlight-next-line
        as(^ -> parent) {
            // parentId, parentName
            #allScalars(TreeNode) 
        }
    }
}
```

è¿™æ ·ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªå¹³å¦çš„DTOç±»å‹ï¼Œå…·æœ‰4ä¸ªå±æ€§ï¼š`id`ã€`name`ã€`parentId`å’Œ`parentName`ã€‚

ç”šè‡³è¿˜å¯ä»¥åµŒå¥—ä½¿ç”¨`flat`å‡½æ•°ï¼Œå°†æ¥å¤šçº§å…³è”è½¬åŒ–ä¸ºå¹³å¦å¯¹è±¡

```sh title="TreeNode.dto"
FlatTreeNodeView {
    
    #allScalars(TreeNode)

    # highlight-next-line
    flat(parent) {
        as(^ -> parent) {
            #allScalars(TreeNode)
        }
        # highlight-next-line
        flat(grandParent) {
            as(^ -> parent) {
                #allScalars(TreeNode)
            }
            
        }   
    }
}
```

è¿™æ ·ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªå¹³å¦çš„DTOç±»å‹ï¼Œå…·æœ‰6ä¸ªå±æ€§ï¼š`id`ã€`name`ã€`parentId`ã€`parentName`ã€`grandParentId`ã€`grandParentName`ã€‚

<Tabs groupId="language">
<TabItem value="java" label="Java">

```java
TreeNode treeNode = treeNodeDraft.$.produce(cola -> {
    cola.setId(4L);
    cola.setName("Coca cola");
    cola.applyParent(drinks -> {
        drinks.setId(3L);
        drinks.setName("Drinks");
        drinks.applyParent(food -> {
            food.setId(2L);
            food.setName("Food");
        })
    })
});

// å°†å±‚æ¬¡åŒ–çš„Entityè½¬åŒ–ä¸ºæ‰å¹³çš„DTO
FlatTreeNodeView view = new FlatTreeNodeView(treeNode);

System.out.println(view);
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin
val treeNode = new(TreeNode::class).by {
    id = 4L
    name = "Coca cola"
    parent().apply {
        id = 3L
        name = "Drinks"
        parent().apply {
            id = 2L
            name = "Food"
        }   
    }
}

// å°†å±‚æ¬¡åŒ–çš„Entityè½¬åŒ–ä¸ºæ‰å¹³çš„DTO
val view = FlatTreeNodeView(treeNode)

println(view)
```

</TabItem>
</Tabs>

æ‰“å°ç»“æœä¸º *(ä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œè¿™é‡Œè¿›è¡Œäº†æ ¼å¼åŒ–)*

```
com.yourcompany.yourproject.FlatTreeNodeView(
    id = 4,
    name = Coco cola,
    parentId = 3,
    parentName = Drinks,
    grandParentId = 2,
    grandParentName = "Food"
)
```

`flat`æ–¹æ¡ˆä¹Ÿæœ‰ç¼ºç‚¹ï¼Œå¯¹**output ** DTOè€Œè¨€ï¼Œ`flat`æ–¹æ¡ˆæ˜¯æœ‰äº‰è®®çš„ï¼Œå¹¶ä¸æ¨èç›²ç›®é‡‡ç”¨ã€‚

è¯·å‚è§<ViewMore buttonText="Output DTOæ˜¯å¦è¯¥ç”¨flatæ¨¡å¼çš„äº‰è®®"><FlatProblem/></ViewMore>

## 11. è‡ªå®šä¹‰å­—æ®µ

### 11.1 åˆè¯†è‡ªå®šä¹‰å­—æ®µ

å‰é¢æˆ‘ä»¬æ‰€è®²çš„ä¾‹å­ä¸­ï¼Œæ‰€æœ‰DTOå±æ€§éƒ½æ˜¯ç”±å®ä½“å±æ€§æ˜ å°„è€Œæ¥ï¼Œæˆä¸ºæ˜ å°„å±æ€§ã€‚

é™¤äº†æ˜ å°„å±æ€§å¤–ï¼ŒDTOç±»å‹è¿˜æ”¯æŒæ˜ å°„è‡ªå®šä¹‰å±æ€§

```sh title="BookInput.dto"  
BookInput {
    
    #allScalars(Author)? - id

    #highlight-next-line
    remark: String
}
```

è¿™é‡Œï¼ŒBookInputå…·å¤‡ä¸€ä¸ªè‡ªå®šä¹‰å±æ€§ï¼š`remark`ã€‚

:::info
è‡ªå®šä¹‰å±æ€§å’Œæ˜ å°„å±æ€§çš„åŒºåˆ«åœ¨äºéœ€è¦ç±»å‹å®šä¹‰ã€‚
:::

### 11.2 å†…ç½®ç±»å‹

è‡ªå®šä¹‰å±æ€§çš„ç±»å‹å¯ä»¥æ˜¯å†…ç½®ç±»å‹ã€‚

æ‰€è°“å†…ç½®ç±»å‹ï¼Œå°±æ˜¯DTOè¯­è¨€å†…ç½®ç±»å‹ï¼Œæ— éœ€é‡‡ç”¨`import`å¯¼å…¥ã€‚

-   åŸç”Ÿå’Œè£…ç®±ç±»å‹

    |DTOè¯­è¨€ç±»å‹|ç”Ÿæˆçš„Javaç±»å‹|ç”Ÿæˆçš„Kotlinç±»å‹|
    |---|---|---|
    |Boolean|boolean|Boolean|
    |Boolean?|Boolean|Boolean?|
    |Char|char|Char|
    |Char?|Character|Char?|
    |Byte|byte|Byte|
    |Byte?|Byte|Byte?|
    |Short|short|Short|
    |Short?|Short|Short?|
    |Int|int|Int|
    |Int?|Integer|Int?|
    |Long|long|Long|
    |Long?|Long|Long?|
    |Float|float|Float|
    |Float?|Float|Float?|
    |Double|double|Double|
    |Double?|Double|Double?|

-   Anyå’ŒStringç±»å‹

    |DTOè¯­è¨€ç±»å‹|ç”Ÿæˆçš„Javaç±»å‹|ç”Ÿæˆçš„Kotlinç±»å‹|
    |---|---|---|
    |Any|Object|Any|
    |String|String|String|

-   æ•°ç»„ç±»å‹

    |DTOè¯­è¨€ç±»å‹|ç”Ÿæˆçš„Javaç±»å‹|ç”Ÿæˆçš„Kotlinç±»å‹|
    |---|---|---|
    |Array&lt;Boolean&gt;|boolean[]|BooleanArray|
    |Array&lt;Boolean?&gt;|Boolean[]|Array&lt;Boolean?&gt;|
    |Array&lt;Char&gt;|char[]|CharArray|
    |Array&lt;Char?&gt;|Character[]|Array&lt;Char?&gt;|
    |Array&lt;Byte&gt;|byte[]|ByteArray|
    |Array&lt;Byte?&gt;|Byte[]|Array&lt;Byte?&gt;|
    |Array&lt;Short&gt;|short[]|ShortArray|
    |Array&lt;Short?&gt;|Short[]|Array&lt;Short?&gt;|
    |Array&lt;Int&gt;|int[]|IntArray|
    |Array&lt;Int?&gt;|Integer[]|Array&lt;Int?&gt;|
    |Array&lt;Long&gt;|long[]|LongArray|
    |Array&lt;Long?&gt;|Long[]|Array&lt;Long?&gt;|
    |Array&lt;Float&gt;|float[]|FloatArray|
    |Array&lt;Float?&gt;|Float[]|Array&lt;Float?&gt;|
    |Array&lt;Double&gt;|double[]|DoubleArray|
    |Array&lt;Double?&gt;|Double[]|Array&lt;Double?&gt;|
    |Array&lt;UserType&gt;|UserType[]|Array&lt;UserType&gt;|
    |Array&lt;UserType?&gt;|UserType[]|Array&lt;UserType?&gt;|
    |Array&lt;*&gt;|Object[]|Array&lt;*&gt;|

-   é›†åˆç±»å‹

    |DTOè¯­è¨€ç±»å‹|ç”Ÿæˆçš„Javaç±»å‹|ç”Ÿæˆçš„Kotlinç±»å‹|
    |---|---|---|
    |Iterable&lt;E&gt;|Iterable&lt;? extends E&gt;|Iterable&lt;E&gt;|
    |MutableIterable&lt;E&gt;|Iterable&lt;E&gt;|MutableIterable&lt;E&gt;|
    |Collection&lt;E&gt;|Collection&lt;? extends E&gt;|Collection&lt;E&gt;|
    |MutableCollection&lt;E&gt;|Collection&lt;E&gt;|MutableCollection&lt;E&gt;|
    |List&lt;E&gt;|List&lt;? extends E&gt;|List&lt;E&gt;|
    |MutableList&lt;E&gt;|List&lt;E&gt;|MutableList&lt;E&gt;|
    |Set&lt;E&gt;|Set&lt;? extends E&gt;|Set&lt;E&gt;|
    |MutableSet&lt;E&gt;|Set&lt;E&gt;|MutableSet&lt;E&gt;|
    |Map&lt;K, V&gt;|Map&lt;? extends K, ? extends V&gt;|Map&lt;K, V&gt;|
    |MutableMap&lt;K, V&gt;|Map&lt;K, V&gt;|Mutable&lt;K, V&gt;|

### 11.3 èŒƒå‹å‚æ•°ä¿®é¥°

é™¤äº†å†…ç½®ç±»å‹ä¸­çš„èŒƒå‹ç±» *(æ•°ç»„å’Œé›†åˆ)* å‹å¤–ï¼Œå…¶ä»–èŒƒå‹ç±»éƒ½æ”¯æŒä½¿ç”¨`in`æˆ–`out`ä¿®é¥°èŒƒå‹å‚æ•°ï¼Œä¾‹å¦‚

|DTOè¯­è¨€ç±»å‹|ç”Ÿæˆçš„Javaç±»å‹|ç”Ÿæˆçš„Kotlinç±»å‹|
|---|---|---|
|UserType1&lt;UserType2&gt;|UserType1&lt;UserType2&gt;|UserType1&lt;UserType2&gt;|
|UserType1&lt;out UserType2&gt;|UserType1&lt;? extends UserType2&gt;|UserType1&lt;out UserType2&gt;|
|UserType1&lt;in UserType2&gt;|UserType1&lt;? super UserType2&gt;|UserType1&lt;in UserType2&gt;|

### 11.4 å¯¼å…¥è¯­å¥

é™¤äº†å†…ç½®ç±»å‹å¤–çš„å…¶ä»–ç±»å‹å¤–ï¼Œå…¶ä»–ç±»å‹åœ¨è¢«å¼•ç”¨æ—¶ï¼Œè¦ä¹ˆä¹¦å†™å…¨åï¼Œè¦ä¹ˆåœ¨æ–‡ä»¶å¼€å¤´ä½¿ç”¨importè¯­å¥ï¼Œå¦åˆ™ï¼Œå°†ä¼šè®¤ä¸ºå…¶åŒå½“å‰å®ä½“å±äºåŒä¸€åŒ…ã€‚

DTOè¯­è¨€æ”¯æŒå¤šç§é£æ ¼çš„importè¯­å¥ï¼Œä¾‹å¦‚

-   å•ç±»å¯¼å…¥

    ```
    import java.time.LocalDateTime
    ```

-   å•ç±»é‡å‘½åå¯¼å…¥

    ```
    import java.time.LocalDateTime as LDT
    ```

-   å¤šç±»å¯¼å…¥

    ```
    import java.time.{ 
        LocalDateTime, 
        OffsetDataTime, 
        ZonedDataTime 
    }
    ```

-   å¤šç±»é‡å‘½åå¯¼å…¥

    ```
    import java.time.{ 
        LocalDateTime as LDT, 
        OffsetDataTime as ODT, 
        ZonedDataTime as ZDT
    }
    ```

## 12. æ³¨è§£

### 12.1 åŸºæœ¬ç”¨æ³•

ä½ å¯ä»¥åœ¨DTOè¯­è¨€ä¸­ä½¿ç”¨æ³¨è§£ä¿®é¥°DTOç±»å‹ã€æ˜ å°„å±æ€§å’Œè‡ªå®šä¹‰å±æ€§

```sh title="Author.dto"
import org.babyfish.jimmer.client.Doc 
import javax.validation.constraints.Size

@Doc("BookInput without associations") â¶
BookInput {
    
    #allScalars

    @Size(min = 4, max = 20) â·
    name

    @Size(min = 10, max = 50) â¸
    remark: String
}
```

å…¶ä¸­

-   â¶ ä¿®é¥°ç±»å‹

-   â· ä¿®é¥°æ˜ å°„å±æ€§

-   â¸ ä¿®é¥°è‡ªå®šä¹‰å±æ€§

:::tip
æœ‰ä¸€ä¸ªç»†èŠ‚éœ€è¦æ³¨æ„
```sh title="BookView"
...çœç•¥import... 

BookView {

    ...çœç•¥å…¶ä»–å±æ€§...

    # highlight-next-line
    @A authors @B {
        ...çœç•¥å…³è”å¯¹è±¡å±æ€§...
    }

    ...çœç•¥å…¶ä»–DTOç±»å‹...
}
```
å…¶ä¸­

-   `@A`ä¿®é¥°`authors`å±æ€§

-   `@B`ä¿®é¥°åŒ¿åçš„å…³è”ç±»å‹
:::

### 12.2 æ³¨è§£æ›¿æ¢

-   å¦‚å‰æ–‡æ‰€è¿°ï¼ŒDTOè¯­è¨€æ”¯æŒæ³¨è§£ï¼Œç›´æ¥æ§åˆ¶è¢«ç”Ÿæˆçš„DTOç±»å‹çš„æ³¨è§£

-   å¦‚æœDTOå±æ€§æ²¡æœ‰è¢«ä»»ä½•æ³¨è§£ä¿®é¥°ï¼Œå°±ä¼šå¤åˆ¶åŸå®ä½“ä¸­å¯¹åº”å±æ€§çš„æ³¨è§£ *(å¦‚æœDTOå±æ€§æ˜¯æ˜ å°„è€Œæ¥ï¼Œè€Œéè‡ªå®šä¹‰çš„)*ã€‚
    å…¶ä¸­ï¼Œé™¤`org.babyfish.jimmer.client`åŒ…ä¸‹çš„å…¶ä»–ä»»ä½• **é** jimmeræ³¨è§£éƒ½ä¼šè¢«å¤åˆ¶åˆ°è¢«ç”Ÿæˆçš„DTOç±»å‹ä¸­

### 12.3 valueå‚æ•°

æ³¨è§£ä¸­çš„`value`å‚æ•°å¯ä»¥è¢«ç®€å†™ï¼Œä¾‹å¦‚

```
@UserAnnotation(value = "a", value2 = "b", value3 = "c")
```

å¯ä»¥è¢«ç®€å†™ä¸º

```
@UserAnnotation("a", value2 = "b", value3 = "c")
```

å’ŒJavaä¸åŒï¼Œæ— è®ºæ³¨è§£æœ‰å¤šå°‘ä¸ªå‚æ•°ï¼Œ`value`å‚æ•°éƒ½å¯ä»¥è¢«ç¼©å†™ï¼Œåªè¦ä¿è¯è¢«ç¼©å†™çš„å±æ€§æœ€å…ˆé…ç½®å³å¯ã€‚

### 12.4 æ··åˆJavaå’ŒKotlinçš„è¯­æ³•

Javaå’ŒKotlinçš„æ³¨è§£è¯­æ³•å­˜åœ¨ä¸€äº›å¾®å¼±çš„å·®å¼‚ï¼ŒDTOè¯­è¨€æ··åˆäº†äºŒè€…çš„ç‰¹å¾ï¼Œä¾‹å¦‚

-   ```
    @UserAnnotation(
        "key1",
        items = {
            @Item("subKey1", description = "Detail information for subKey1 ..."),
            @Item("subKey2", description = "Detail information for subKey2 ..."),
            @Item("subKey3", description = "Detail information for subKey3 ...")
        }
    )
    ```

-   ```
    @UserAnnotation(
        "key1",
        items = [
            @Item("subKey1", description = "Detail information for subKey1 ..."),
            @Item("subKey2", description = "Detail information for subKey2 ..."),
            @Item("subKey3", description = "Detail information for subKey3 ...")
        ]
    )
    ```

-   ```
    @UserAnnotation(
        "key1",
        items = {
            Item("subKey1", description = "Detail information or subKey1 ..."),
            Item("subKey2", description = "Detail information for subKey2 ..."),
            Item("subKey3", description = "Detail information for subKey3 ...")
        }
    )
    ```

-   ```
    @UserAnnotation(
        "key1",
        items = [
            Item("subKey1", description = "Detail information for subKey1 ..."),
            Item("subKey2", description = "Detail information for subKey2 ..."),
            Item("subKey3", description = "Detail information for subKey3 ...")
        ]
    )
    ```

ä»¥ä¸Šå››ç§å†™æ³•æ˜¯ç­‰ä»·çš„ã€‚ä½ å¯ä»¥éšæ„é€‰æ‹©ä½ å–œæ¬¢çš„ç³»æ³•ã€‚
