---
sidebar_position: 14
title: ğŸ”¥ è¶…çº§QBEæŸ¥è¯¢
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

Super QBEæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œåˆ©ç”¨[DTOè¯­è¨€](../object/view/dto-language)ç”Ÿæˆå¤æ‚æŸ¥è¯¢çš„å‚æ•°ç±»å‹ï¼Œå¹¶è‡ªåŠ¨å®ç°æŸ¥è¯¢é€»è¾‘ã€‚

## åˆ›å»ºæ–‡ä»¶

åœ¨ä»»ä½•å¯ä»¥è®¿é—®å®ä½“ç±»å‹çš„é¡¹ç›®ä¸­ï¼Œåˆ›å»º`src/main/dto`ç›®å½•ï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶`Book.dto`ã€‚

å¯¹äºJavaé¡¹ç›®è€Œè¨€ï¼Œå¦‚æœå½“å‰é¡¹ç›®å¹¶éå®šä¹‰å®ä½“ç±»å‹çš„é¡¹ç›®ï¼Œéœ€è¦åœ¨ä¸ºå½“å‰é¡¹ç›®ä¸­ä»»ä½•ä¸€ä¸ªç±»æ·»åŠ `@EnableDtoGeneration`æ³¨è§£ã€‚

åœ¨æ–‡ä»¶å¤´éƒ¨æ·»åŠ å¦‚ä¸‹ä»£ç 

```sh
export com.yourcompany.yourproject.model.Book
    -> package com.yourcompany.yourproject.dto
```

ä»¥ä¸Šè¿™äº›æ­¥éª¤ï¼Œä»¥åŠå¦‚ä½•ç¼–è¯‘DTOæ–‡ä»¶ï¼Œåœ¨[DTOè¯­è¨€#2. åˆ›å»ºæ–‡ä»¶](../object/view/dto-language#2-åˆ›å»ºæ–‡ä»¶)ä¸­æœ‰è¯¦ç»†çš„è®¨è®ºï¼Œæœ¬æ–‡ä¸ä½œé‡å¤æ€§é˜è¿°ã€‚

## å®šä¹‰Specificationç±»å‹

```sh
...çœç•¥exportè¯­å¥...

specification BookSpecification {

}
```

### ç¼–è¯‘åçš„ä»£ç 

ç¼–è¯‘åï¼Œå°†ä¼šç”Ÿæˆè¿™æ ·çš„Java/Kotlinä»£ç 

<Tabs groupId="language">
<TabItem value="java" label="Java">

```java title="BookSpecification.java"
package com.yourcompany.yourproject.dto;

import org.babyfish.jimmer.sql.ast.query.specification.JSpecification;
import org.babyfish.jimmer.sql.ast.query.specification.SpecificationArgs;
...çœç•¥å…¶ä»–importè¯­å¥...

public class BookSpecification implements JSpecification<Book, BookTable> {

    @Override
    public void applyTo(SpecificationArgs<Book, BookTable> args) {}
}
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin title="BookSpecification.kt"
package com.yourcompany.yourproject.dto;

import org.babyfish.jimmer.sql.kt.ast.query.specification.KSpecification
import org.babyfish.jimmer.sql.kt.ast.query.specification.KSpecificationArgs
...çœç•¥å…¶ä»–importè¯­å¥...

data class BookSpecification(
    // ç°åœ¨data classæš‚æ—¶æ²¡æœ‰å­—æ®µï¼Œä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯
) : KSpecification<Book> {

    override fun applyTo(args: KSpecificationArgs<Book>) {}
}
```

</TabItem>
</Tabs>

:::info
`applyTo`æ˜¯specificationç¼–è¯‘åç”Ÿæˆçš„ä»£ç ä¸­çš„ç‰¹æœ‰æ–¹æ³•ï¼ŒæŒ‰ç…§å½“å‰å¯¹è±¡çš„ä¿¡æ¯åŠ¨æ€åœ°ä¸ºJimmeræŸ¥è¯¢æ·»åŠ whereæ¡ä»¶ã€‚

æ­¤æ–¹æ³•æ— éœ€ç”¨æˆ·è°ƒç”¨ *(è¢«Jimmerå†…éƒ¨è¡Œä¸ºè°ƒç”¨)* ï¼Œç”¨æˆ·ä¹Ÿæ— éœ€å…³å¿ƒå…¶å†…éƒ¨ä»£ç å®ç°ã€‚è¿™é‡Œåªéœ€è¦çŸ¥é“æ­¤æ–¹æ³•æœ‰ä»€ä¹ˆç”¨å³å¯ã€‚
:::

åœ¨åç»­çš„è®¨è®ºä¸­ï¼Œæˆ‘ä»¬ä¼šé™†ç»­ä¸ºDTOæ–‡ä»¶ä¸­çš„`BookSpecification`æ·»åŠ å±æ€§ã€‚

ç›¸åº”åœ°ï¼Œå¯¹äºè‡ªåŠ¨ç”Ÿæˆçš„`BookSpecification`ç±»è€Œè¨€ï¼Œä¸€æ–¹é¢å±æ€§ä¼šåŒæ­¥å¢åŠ ï¼Œå¦å¤–ä¸€æ–¹é¢ï¼Œ`applyTo`æ–¹æ³•ä¸­çš„ä»£ç ä¹Ÿä¼šå˜å¤šã€‚

### ç”¨æ³•

-   åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨

    <Tabs groupId="language">
    <TabItem value="java" label="Java">

    ```java
    public List<Book> find(
        // highlight-next-line
        JSpecification<?, BookTable> specification â¶
    ) {
        
        BookTable table = BookTable.$;
        
        return sqlClient
            .createQuery(table)
            // highlight-next-line
            .where(specification) â·
            .select(table)
            .execute();
    }
    ```

    </TabItem>
    <TabItem value="kotlin" label="Kotlin">

    ```kotlin
    fun find(
        // highlight-next-line
        specification: KSpecification<Book> â¶
    ): List<Book> =
        sqlClient.createQuery(Book::class) {
            // highlight-next-line
            where(specification) â·
            select(table)
        }.execute()
    ```

    </TabItem>
    </Tabs>

    -   â¶ JavaæŸ¥è¯¢å‚æ•°ç±»å‹ä¸º`JSpecification<?, BookTable>`ï¼ŒKolinæŸ¥è¯¢å‚æ•°ä¸º`KSpecification<Book>`ã€‚

        äºŒè€…å­˜åœ¨ç»†å¾®å·®å¼‚ï¼Œä½†éƒ½ç»§æ‰¿äº`org.babyfish.jimmer.Specification<Book>`ç±»å‹ã€‚

    -   â· æ— è®º`specification`æ ¼å¼ç®€å•è¿˜æ˜¯å¤æ‚ï¼Œåªéœ€ä¸€ä¸ªç®€å•çš„`where`è¯­å¥å°±å¯ä»¥ä½¿ç”¨ã€‚

-   åœ¨Spring Data Repositoryä¸­ä½¿ç”¨

    Jimmeræ•´åˆäº†Spring Dataï¼Œæ‰€ä»¥èƒ½å®šä¹‰Spring Data Repositoryï¼Œè¯·å‚è€ƒ[SpringDataé£æ ¼](../spring/repository)ä»¥äº†è§£æ›´å¤šã€‚

    Jimmerçš„Spring Data Repositoryæœ‰ä¸¤ç§æŸ¥è¯¢é£æ ¼ï¼ŒæŠ½è±¡æ–¹æ³•å’Œdefaultæ–¹æ³•ã€‚defaultæ–¹æ³•ä½¿ç”¨specificationçš„ä»£ç å’Œä¸Šé¢é›·åŒï¼Œ
    æ‰€ä»¥ï¼Œæˆ‘ä»¬çœ‹çœ‹æŠ½è±¡æŸ¥è¯¢æ–¹æ³•ä½¿ç”¨specifiationçš„ä¾‹å­

    <Tabs groupId="language">
    <TabItem value="java" label="Java">

    ```java
    public interface BookRepository : JRepository<Book, Long> {

        public List<Book> find(
            // highlight-next-line
            Specification<Book> specification
        )
    }
    ```

    </TabItem>
    <TabItem value="kotlin" label="Kotlin">

    ```kotlin
    interface BookRepository : KRepository<Book, Long> {

        fun find(
            // highlight-next-line
            specification: Specification<Book>
        ): List<Book>
    }
    ```

    </TabItem>
    </Tabs>

    åœ¨Spring Data Repositoryçš„æŠ½è±¡æ–¹æ³•ä¸­å£°æ˜specificationå‚æ•°æ—¶ï¼Œæ— éœ€åŒºåˆ†`JSpecification`å’Œ`KSpecification`ï¼Œ
    ç»Ÿä¸€ç”¨`org.babyfish.jimmer.Specification`ç±»å‹å³å¯ã€‚

## å±æ€§æ˜ å°„

### æ˜ å°„å±æ€§

```sh
...çœç•¥exportè¯­å¥...

specification BookSpecification {
    #highlight-next-line
    name
}
```

è¿™æ ·ï¼Œå°±å°†å®ä½“å±æ€§æ˜ å°„åˆ°äº†DTOä¸­ï¼Œç”Ÿæˆçš„ä»£ç ä¸º

<Tabs groupId="language">
<TabItem value="java" label="Java">

```java title="BookSpecification.java"
public class BookSpecification implements JSpecification<Book, BookTable> {

    @Nullable
    // highlight-next-line
    private String name;

    ...çœç•¥getterså’Œsetters...

    @Override
    public void applyTo(SpecificationArgs<Book, BookTable> args) {
        ...ç•¥...
    }
}
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin title="BookSpecification.kt"
package com.yourcompany.yourproject.dto;

import org.babyfish.jimmer.sql.kt.ast.query.specification.KSpecification
import org.babyfish.jimmer.sql.kt.ast.query.specification.KSpecificationArgs
...çœç•¥å…¶ä»–importè¯­å¥...

data class BookSpecification(
    // highlight-next-line
    val name: String? = null
) : KSpecification<Book> {

    override fun applyTo(args: KSpecificationArgs<Book>) {
        ...ç•¥...
    }
}
```

</TabItem>
</Tabs>

### å¯ç©ºæ€§

æˆ‘ä»¬å‘ç°ï¼Œåœ¨ç”Ÿæˆçš„ä»£ç ä¸­`name`å­—æ®µæ—¶å¯ä»¥ä¸ºnullçš„ï¼Œè¿™æ˜¯specificationçš„ç‰¹æ®Šæ€§æ‰€åœ¨ã€‚

:::tip
specificationç”¨ä½œæŸ¥è¯¢å‚æ•°ï¼Œä¸ºäº†æ”¯æŒåŠ¨æ€æŸ¥è¯¢ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å±æ€§éƒ½æ˜¯å¯ä»¥ä¸ºnullçš„ã€‚é™¤éæ˜¾å¼åœ°ä½¿ç”¨`!`è§„å®šå±æ€§ä¸èƒ½ä¸ºnull*(è¯·å‚è§[DTOè¯­è¨€#7. å¯ç©ºæ€§](../object/view/dto-language#7-å¯ç©ºæ€§))*ã€‚
:::

### ç”¨æ³•

-   è®©BookSpecifiationçš„`name`å­—æ®µä¸ºnull

    <Tabs groupId="language">
    <TabItem value="java" label="Java">

    ```java
    BookSpecification specification = new BookSpecification();
    List<Book> books = bookRepository.find(specification);
    ```

    </TabItem>
    <TabItem value="kotlin" label="Kotlin">

    ```kotlin
    val specification = BookSpecification()
    val books = bookRepository.find(specification)
    ```

    </TabItem>
    </Tabs>

    ç”±äº`specification.name`ä¸ºnullï¼Œç”Ÿæˆçš„SQLä¸ä¼šå¸¦ä»»ä½•`where`æ¡ä»¶
    
    ç”Ÿæˆçš„SQLå¦‚ä¸‹

    ```sql
    select tb_1_.ID, tb_1_.NAME, tb_1_.EDITION, tb_1_.PRICE, tb_1_.STORE_ID
    from BOOK tb_1_
    where tb_1_.NAME = ?
    ```
    
    :::info
    è¿™ç§ä¸æŒ‡å®šspecificationç›¸å…³å±æ€§çš„æŸ¥è¯¢ï¼Œå¿…ç„¶å¯¼è‡´æŸ¥è¯¢æ²¡æœ‰ä»»ä½•æ¡ä»¶ã€‚
    
    è¿™ç§ä¾‹å­æœ¬æ–‡ä»…ä»…ç¤ºèŒƒä¸€æ¬¡ã€‚
    :::

-   è®©BookSpecifiationçš„`name`å­—æ®µä¸ä¸ºnull

    <Tabs groupId="language">
    <TabItem value="java" label="Java">

    ```java
    BookSpecification specification = new BookSpecification();
    // highlight-next-line
    specification.setName("GraphQL in Action");
    List<Book> books = bookRepository.find(specification);
    ```

    </TabItem>
    <TabItem value="kotlin" label="Kotlin">

    ```kotlin
    val specification = BookSpecification(
        // highlight-next-line
        name = "GraphQL in Action"
    )
    val books = bookRepository.find(specification)
    ```

    </TabItem>
    </Tabs>

    ç”Ÿæˆçš„SQLå¦‚ä¸‹

    ```sql
    select tb_1_.ID, tb_1_.NAME, tb_1_.EDITION, tb_1_.PRICE, tb_1_.STORE_ID
    from BOOK tb_1_
    /* highlight-next-line */
    where tb_1_.NAME = ? /* GraphQL in Action */
    ```

## QBEå‡½æ•°

### åˆè¯†QBEå‡½æ•°

ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå½“æŒ‡å®šäº†`specification.name`åï¼Œç”Ÿæˆçš„`where`æ¡ä»¶æ˜¯ç­‰äºã€‚

ç­‰äºä¸ä¸€å®šæ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œå¯ä»¥ä¸ºæ˜ å°„å±æ€§æ–½åŠ QBEå‡½æ•°ï¼Œæ”¹å˜è¿ç®—ç¬¦ï¼Œä»¥`like`ä¸ºä¾‹

```sh
...çœç•¥exportè¯­å¥...

specification BookSpecification {
    #highlight-next-line
    like(name)
}
```

likeå‡½æ•°ä¸ä¼šå½±å“ç”Ÿæˆçš„`BookSpecification`ç±»çš„å±æ€§ï¼Œä½†æ˜¯ä¼šå½±å“å…¶`applyTo`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å†…éƒ¨å®ç°æ˜¯`where`æ¡ä»¶çš„æ·»åŠ é€»è¾‘ï¼Œæ— éœ€ç”¨æˆ·å…³å¿ƒã€‚

æ‰§è¡Œ

<Tabs groupId="language">
<TabItem value="java" label="Java">

```java
BookSpecification specification = new BookSpecification();
// highlight-next-line
specification.setName("GraphQL");
List<Book> books = bookRepository.find(specification);
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin
val specification = BookSpecification(
    // highlight-next-line
    name = "GraphQL"
)
val books = bookRepository.find(specification)
```

</TabItem>
</Tabs>

ç”Ÿæˆçš„SQLå¦‚ä¸‹

```sql
select tb_1_.ID, tb_1_.NAME, tb_1_.EDITION, tb_1_.PRICE, tb_1_.STORE_ID
from BOOK tb_1_
/* highlight-next-line */
where tb_1_.NAME like ? /* %GraphQL% */
```

### likeå‡½æ•°çš„é€‰é¡¹

`like`æ˜¯æ‰€æœ‰QBEå‡½æ•°ä¸­æ¯”è¾ƒç‰¹æ®Šçš„ä¸€ä¸ªï¼Œæ”¯æŒ3ä¸ªé€‰é¡¹

-   i: å¤§å°å†™ä¸æ•æ„Ÿ

-   ^: ç²¾ç¡®åŒ¹é…å¼€å¤´ *(Jimmerä¸ä¼šè‡ªåŠ¨åœ¨å‚æ•°å€¼å‰é¢åŠ `%`)*

-   $: ç²¾ç¡®åŒ¹é…ç»“å°¾ *(Jimmerä¸ä¼šè‡ªåŠ¨åœ¨å‚æ•°å€¼åé¢åŠ `%`)*

å¦‚æœéœ€è¦é€‰é¡¹ï¼Œå¯ä»¥åœ¨`like`åé¢åŠ `/`ï¼Œå†åŠ ä¸Šéœ€è¦çš„é€‰é¡¹ã€‚æ¯”å¦‚ï¼š`like/i`ã€`like/^`ã€`like/$`ã€`like/i^`ã€`like/i$`å’Œ`like/i^$`ã€‚

:::caution
è™½ç„¶`i`ã€`^`å’Œ`$`éƒ½æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯å½¼æ­¤å…ˆåé¡ºåºæ˜¯å›ºå®šçš„ã€‚
:::

è®©æˆ‘ä»¬æ¥è¯•è¯•å¤§å°å†™ä¸æ•æ„Ÿçš„`like`ï¼Œä¿®æ”¹DTOä»£ç å¦‚ä¸‹

```sh
...çœç•¥exportè¯­å¥...

specification BookSpecification {
    #highlight-next-line
    like/i(name)
}
```

å†æ¬¡æ‰§è¡Œä¸Šé¢çš„ä»£ç ï¼Œæ‰§è¡Œå¦‚ä¸‹SQL

-   ä¸æ”¯æŒ`ilike`çš„æ•°æ®åº“

    ```sql
    select tb_1_.ID, tb_1_.NAME, tb_1_.EDITION, tb_1_.PRICE, tb_1_.STORE_ID
    from BOOK tb_1_
    /* highlight-next-line */
    where lower(tb_1_.NAME) like ? /* %graphql% */
    ```

-   æ”¯æŒ`ilike`çš„æ•°æ®åº“

    ```sql
    select tb_1_.ID, tb_1_.NAME, tb_1_.EDITION, tb_1_.PRICE, tb_1_.STORE_ID
    from BOOK tb_1_
    /* highlight-next-line */
    where tb_1_.NAME ilike ? /* %graphql% */
    ```

### æ‰€æœ‰QBEå‡½æ•°

äº‹å®ä¸Šï¼Œé™¤äº†`like`å¤–ï¼Œspeciationæ”¯æŒå¤§é‡çš„QBEå‡½æ•°ï¼Œæ¶µç›–äº†å¸¸è§çš„SQLåˆ¤æ–­ï¼Œå¦‚ä¸‹è¡¨

|QBEå‡½æ•°|åŸå®ä½“å±æ€§ç±»å‹ *(æˆ–è¦æ±‚)*|ç”Ÿæˆçš„DTOç±»å±æ€§çš„ç±»å‹|å¤‡æ³¨|
|---|---|---|---|
|eq|ä»»ä½•éå…³è”å±æ€§|åŸç±»å‹|ç­‰äºï¼Œå’Œä¸ä½¿ç”¨ä»»ä½•QBEå‡½æ•°ç­‰ä»·|
|ne|ä»»ä½•éå…³è”å±æ€§|åŸç±»å‹|ä¸ç­‰äº|
|gt|ä»»ä½•éå…³è”å±æ€§|åŸç±»å‹|å¤§äº|
|ge|ä»»ä½•éå…³è”å±æ€§|åŸç±»å‹|å¤§äºæˆ–ç­‰äº|
|lt|ä»»ä½•éå…³è”å±æ€§|åŸç±»å‹|å°äº|
|le|ä»»ä½•éå…³è”å±æ€§|åŸç±»å‹|å°äºæˆ–ç­‰äº|
|like|String|String|æ¨¡ç³ŠåŒ¹é…|
|notLike|String|String|æ¨¡ç³Šä¸åŒ¹é…|
|null|ä»»ä½•å±æ€§|boolean|å¦‚æœDTOå±æ€§ä¸ºtrueï¼Œis nullåˆ¤æ–­|
|notNull|ä»»ä½•å±æ€§|boolean|å¦‚æœDTOå±æ€§ä¸ºtrueï¼Œis not nullåˆ¤æ–­|
|valueIn|ä»»ä½•éå…³è”å±æ€§|List<åŸç±»å‹>|in(...)|
|valueNotIn|ä»»ä½•éå…³è”å±æ€§|List<åŸç±»å‹>|not in(...)|
|associatedIdEq|ä»»ä½•å…³è”å±æ€§|å…³è”å®ä½“çš„idå±æ€§çš„ç±»å‹|å…³è”id = ?ã€‚æ³¨æ„ï¼Œå’Œ`id`*(DTOè¯­è¨€å›ºæœ‰å‡½æ•°)* ç­‰ä»·|
|associatedIdNe|ä»»ä½•å…³è”å±æ€§|å…³è”å®ä½“çš„idå±æ€§çš„ç±»å‹|å…³è”id &lt;&gt; ?|
|associatedIdIn|ä»»ä½•å…³è”å±æ€§|List<å…³è”å®ä½“çš„idå±æ€§çš„ç±»å‹>|å…³è”id in(...)|
|associatedIdNotIn|ä»»ä½•å…³è”å±æ€§|List<å…³è”å®ä½“çš„idå±æ€§çš„ç±»å‹>|å…³è”id not in(...)|

### ç»¼åˆç¤ºèŒƒ

ä¿®æ”¹DTOä»£ç 

```sh
...çœç•¥exportè¯­å¥...

specification BookSpecification {
    like/i(name)
    ge(price)
    le(price)
}
```

`ge(price)`ä¼šæŒ‡å®šé»˜è®¤çš„åˆ«å`minPrice`ï¼Œ`le(price)`ä¼šæŒ‡å®šé»˜è®¤çš„åˆ«å`maxPrice`ï¼Œå› æ­¤ï¼Œä¸Šè¿°ä»£ç ä¹Ÿå¯ä»¥å†™ä¸º

```sh
...çœç•¥exportè¯­å¥...

specification BookSpecification {
    like/i(name)
    ge(price) as minPrice
    le(price) as maxPrice
}
```

ç”±æ­¤å¯è§ï¼ŒæŸäº›QBEå‡½æ•°è‡ªå¸¦é»˜è®¤aliasçš„åŠŸèƒ½ã€‚

**å‡è®¾åŸå±æ€§åç§°ä¸º`Prop`**ï¼Œæ‰€æœ‰QBEå‡½æ•°çš„é»˜è®¤aliasè¡Œä¸ºå¦‚ä¸‹

|QBEå‡½æ•°|é»˜è®¤alias|
|---|---|
|eq *(æˆ–ä¸æŒ‡å®šQBEå‡½æ•°)* |`prop`|
|ne|ä¸æ”¯æŒï¼Œä¸æŒ‡å®šaliasä¼šå¯¼è‡´ç¼–è¯‘é”™|
|gt|`minPropExclusive`|
|ge|`minProp`|
|lt|`maxPropExclusive`|
|le|`maxProp`|
|like|`prop`|
|notLike|ä¸æ”¯æŒï¼Œä¸æŒ‡å®šaliasä¼šå¯¼è‡´ç¼–è¯‘é”™|
|valueIn|ä¸æ”¯æŒï¼Œä¸æŒ‡å®šaliasä¼šå¯¼è‡´ç¼–è¯‘é”™|
|valueNotIn|ä¸æ”¯æŒï¼Œä¸æŒ‡å®šaliasä¼šå¯¼è‡´ç¼–è¯‘é”™|
|associatedIdEqæˆ–id|å¦‚æœå…³è”æ˜¯å¼•ç”¨ *(éé›†åˆ)*ï¼Œ`propId`ï¼›å¦åˆ™ï¼Œç¼–è¯‘æŠ¥é”™|
|associatedIdNe|å¦‚æœå…³è”æ˜¯å¼•ç”¨ *(éé›†åˆ)*ï¼Œ`excludedPropId`ï¼›å¦åˆ™ï¼Œç¼–è¯‘æŠ¥é”™|
|associatedIdIn|å¦‚æœå…³è”æ˜¯å¼•ç”¨ *(éé›†åˆ)*ï¼Œ`propIds`ï¼›å¦åˆ™ï¼Œç¼–è¯‘æŠ¥é”™|
|associatedIdNotNull|å¦‚æœå…³è”æ˜¯å¼•ç”¨ *(éé›†åˆ)*ï¼Œ`excludedPropIds`ï¼›å¦åˆ™ï¼Œç¼–è¯‘æŠ¥é”™|

ç¼–è¯‘åç”Ÿæˆçš„ä»£ç ä¸º

<Tabs groupId="language">
<TabItem value="java" label="Java">

```java title="BookSpecification.java"
public class BookSpecification implements JSpecification<Book, BookTable> {

    @Nullable
    private String name;

    @Nullable
    private BigDecimal minPrice;

    @Nullable
    private BigDecimal maxPrice;

    ...çœç•¥getterså’Œsetters...

    @Override
    public void applyTo(SpecificationArgs<Book, BookTable> args) {
        ...ç•¥...
    }
}
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin title="BookSpecification.kt"
package com.yourcompany.yourproject.dto;

import org.babyfish.jimmer.sql.kt.ast.query.specification.KSpecification
import org.babyfish.jimmer.sql.kt.ast.query.specification.KSpecificationArgs
...çœç•¥å…¶ä»–importè¯­å¥...

data class BookSpecification(
    val name: String? = null,
    val minPrice: BigDecimal? = null,
    val maxPrice: BigDecimal? = null
) : KSpecification<Book> {

    override fun applyTo(args: KSpecificationArgs<Book>) {
        ...ç•¥...
    }
}
```

</TabItem>
</Tabs>

æ‰§è¡Œ

<Tabs groupId="language">
<TabItem value="java" label="Java">

```java
BookSpecification specification = new BookSpecification();
specification.setName("GraphQL");
specification.setMinPrice(new BigDecimal(40));
specification.setMaxPrice(new BigDecimal(40));
List<Book> books = bookRepository.find(specification);
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin
val specification = BookSpecification(
    name = "GraphQL",
    minPrice = BigDecimal(40),
    maxPrice = BigDecimal(60)
)
val books = bookRepository.find(specification)
```

</TabItem>
</Tabs>

ç”Ÿæˆçš„SQLå¦‚ä¸‹

```sql
select tb_1_.ID, tb_1_.NAME, tb_1_.EDITION, tb_1_.PRICE, tb_1_.STORE_ID
from BOOK tb_1_
where
        lower(tb_1_.NAME) like ? /* %graphql% */
    and
        tb_1_.PRICE >= ? /* 40 */
    and
        tb_1_.PRICE <= ? /* 60 */
order by
    tb_1_.NAME asc,
    tb_1_.EDITION desc
```

## å…³è”å¯¹è±¡

ä¹‹å‰ä¾‹å­ï¼Œæ‰€æœ‰è¿‡æ»¤è§„åˆ™éƒ½æ˜¯é’ˆå¯¹å½“å‰è¡¨å­—æ®µçš„ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¯¹å…³è”å¯¹è±¡è¿›è¡Œè¿‡æ»¤ã€‚ä¿®æ”¹DTOæ–‡ä»¶å¦‚ä¸‹

```sh
...çœç•¥exportè¯­å¥...

specification BookSpecification {
    like/i(name)
    ge(price)
    le(price)
    #highlight-next-line
    flat(store) { â¶ 
        like/i(name) as storeName
    }
    #highlight-next-line
    flat(authors) { â· 
        like/i(firstName) as authorName
    }
}
```

æˆ‘ä»¬å‘ç°ï¼Œä¸Šé¢çš„ä»£ç ä½¿ç”¨äº†`flat`å‡½æ•°ã€‚flatå‡½æ•°åœ¨[DTOè¯­è¨€#10.4-flatå‡½æ•°](../object/view/dto-language#104-flatå‡½æ•°)ä¸­æœ‰è¯¦ç»†è®¨è®ºï¼Œæœ¬æ–‡ä¸ä½œé‡å¤æ€§é˜è¿°ã€‚

:::info
ç”±äº`specification`ä½œä¸ºå¤æ‚æŸ¥è¯¢çš„å‚æ•°ï¼Œå¾ˆæœ‰å¯èƒ½HTTP GETå‚æ•°ã€‚é‡‡ç”¨`flat`å‡½æ•°æ¶ˆé™¤å…³è”ï¼Œç”Ÿæˆå¹³å¦çš„DTOå¯¹è±¡ï¼Œæ›´æœ‰åˆ©äºåŸºäºSpring MVCå¼€å‘HTTP GET APIã€‚
:::

-   â¶ `Book.store`æ˜¯å¼•ç”¨å…³è”

-   â· `Book.authors`æ˜¯é›†åˆå…³è”

ç¼–è¯‘åç”Ÿæˆçš„ä»£ç ä¸º

<Tabs groupId="language">
<TabItem value="java" label="Java">

```java title="BookSpecification.java"
public class BookSpecification implements JSpecification<Book, BookTable> {

    @Nullable
    private String name;

    @Nullable
    private BigDecimal minPrice;

    @Nullable
    private BigDecimal maxPrice;

    @Nullable
    private String storeName;

    @Nullable
    private String authorName;

    ...çœç•¥getterså’Œsetters...

    @Override
    public void applyTo(SpecificationArgs<Book, BookTable> args) {
        ...ç•¥...
    }
}
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin title="BookSpecification.kt"
package com.yourcompany.yourproject.dto;

import org.babyfish.jimmer.sql.kt.ast.query.specification.KSpecification
import org.babyfish.jimmer.sql.kt.ast.query.specification.KSpecificationArgs
...çœç•¥å…¶ä»–importè¯­å¥...

data class BookSpecification(
    val name: String? = null,
    val minPrice: BigDecimal? = null,
    val maxPrice: BigDecimal? = null,
    val storeName: String? = null,
    val authorName: String? = null
) : KSpecification<Book> {

    override fun applyTo(args: KSpecificationArgs<Book>) {
        ...ç•¥...
    }
}
```

</TabItem>
</Tabs>

æ‰§è¡Œ

<Tabs groupId="language">
<TabItem value="java" label="Java">

```java
BookSpecification specification = new BookSpecification();
specification.setStoreName("MANNING");
specification.setAuthorName("a");
List<Book> books = bookRepository.find(specification);
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin
val specification = BookSpecification(
    storeName = "MANNING",
    authorName = "a"
)
val books = bookRepository.find(specification)
```

</TabItem>
</Tabs>

ç”Ÿæˆçš„SQLå¦‚ä¸‹

```sql
select tb_1_.ID, tb_1_.NAME, tb_1_.EDITION, tb_1_.PRICE, tb_1_.STORE_ID
from BOOK tb_1_
/* highlight-next-line */
inner join BOOK_STORE tb_2_ /* â¶ */
    on tb_1_.STORE_ID = tb_2_.ID
where
        tb_2_.NAME ilike ? /* %manning% */
    and
        /* highlight-next-line */
        exists( /* â· */
            select
                1
            from AUTHOR tb_3_
            inner join BOOK_AUTHOR_MAPPING tb_4_
                on tb_3_.ID = tb_4_.AUTHOR_ID
            where
                    tb_1_.ID = tb_4_.BOOK_ID
                and
                    tb_3_.FIRST_NAME ilike ? /* %a% */
                    
        )
```

-   â¶ `Book.store`æ˜¯å¼•ç”¨å…³è”ï¼Œä¸ä¼šç ´å[åˆ†é¡µå®‰å…¨æ€§](./dynamic-join/table-ex)ã€‚

    å› æ­¤ï¼Œä»…ä½¿ç”¨[åŠ¨æ€JOIN](./dynamic-join/)å³å¯åº”ç”¨DTOå¯¹è±¡`storeName`å±æ€§æ‰€è¡¨ç¤ºçš„è¿‡æ»¤æ¡ä»¶ã€‚

-   â· `Book.authors`æ˜¯é›†åˆå…³è”ï¼Œä¼šç ´å[åˆ†é¡µå®‰å…¨æ€§](./dynamic-join/table-ex)ã€‚

    å› æ­¤ï¼Œä¸èƒ½ä½¿ç”¨[åŠ¨æ€JOIN](./dynamic-join/)ï¼Œå¿…é¡»ä½¿ç”¨[å­æŸ¥è¯¢](./sub-query)æ‰èƒ½åº”ç”¨DTOå¯¹è±¡`authorName`å±æ€§æ‰€è¡¨ç¤ºçš„è¿‡æ»¤æ¡ä»¶ã€‚

## é€»è¾‘æˆ–

ä¹‹å‰çš„ä¾‹å­ä¸­ï¼ŒJimmerä¼šæŒ‰ç…§DTOå¯¹è±¡çš„æ¯ä¸ªå±æ€§æ¥ç”Ÿæˆè‹¥å¹²ä¸ª`where`æ¡ä»¶ï¼Œè¿™äº›æ¡ä»¶ä¹‹é—´çš„å…³ç³»æ˜¯é€»è¾‘ä¸ï¼Œä½†èƒ½å¦æ”¯æŒé€»è¾‘æˆ–å‘¢ï¼Ÿ

å¦å¤–ï¼Œå®ä½“ç±»å‹`Author`é™¤äº†`firstName`å±æ€§å¤–è¿˜æœ‰`lastName`ï¼Œä¸Šä¸€ä¸ªä¾‹å­ä¸­çš„`authorName`åªæ˜ å°„äº†`firstName`æ˜¾å¾—ä¸å¤ªåˆç†ï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„åŠæ³•ï¼Ÿ

ä»¥ä¸Šä¸¤ä¸ªé—®é¢˜æ˜¯åŒä¸€ä¸ªé—®é¢˜ã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒSuper QBEæ”¯æŒé€»è¾‘æˆ–ï¼Œä¹Ÿç§°å‘¼å¤šå±æ€§æ˜ å°„ã€‚

ä¿®æ”¹DTOä»£ç ï¼Œå¦‚ä¸‹

```sh
...çœç•¥exportè¯­å¥...

specification BookSpecification {
    like/i(name)
    ge(price)
    le(price)
    flat(store) {
        like/i(name) as storeName
    }
    flat(authors) {
        // highlight-next-line
        like/i(firstName, lastName) as authorName
    }
}
```

è¿™é‡Œï¼ŒDTOå±æ€§`authorName`æ˜ å°„äº†ä¸¤ä¸ªå±æ€§ï¼Œ`firstName`å’Œ`lastName`ï¼Œè¿™å°±å«åšå¤šå±æ€§æ˜ å°„ã€‚

-   å¤šå±æ€§æ˜ å°„åªèƒ½åœ¨`specification`ä¸­ä½¿ç”¨ï¼Œæ— æ³•åœ¨[DTOè¯­è¨€](../object/view/dto-language)æ‰€æè¿°çš„å…¶ä»–ç±»å‹ä¸­ä½¿ç”¨ã€‚

-   è¢«QBEå‡½æ•°æ˜ å°„çš„å¤šä¸ªå±æ€§çš„ç±»å‹å¿…é¡»å®Œå…¨ä¸€è‡´ *(ä½†å¯ç©ºæ€§å…è®¸ä¸åŒ)*ã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œçš„`firstName`å’Œ`lastName`éƒ½æ˜¯`String`ç±»å‹`ã€‚

-   å¤šå±æ€§æ˜ å°„çš„DTOå±æ€§å¿…é¡»é€šè¿‡`as`æŒ‡å®šåˆ«åï¼Œå¦åˆ™ä¼šå¯¼è‡´ç¼–è¯‘é”™ã€‚

-   å¹¶éæ‰€æœ‰QBEå‡½æ•°éƒ½æ”¯æŒå¤šå±æ€§æ˜ å°„ï¼Œæ”¯æŒå¤šå±æ€§æ˜ å°„çš„QBEå‡½æ•°å¦‚ä¸‹ï¼š

    -   eq
    -   ne
    -   null
    -   notNull
    -   valueIn
    -   associatedIdEq
    -   associatedIdIn

    ç›²ç›®åœ°è®©æ‰€æœ‰QBEå‡½æ•°éƒ½æ”¯æŒå¤šå±æ€§æ˜ å°„ä¼šå¸¦æ¥ç†è§£æ­§ä¹‰ã€‚æ‰€ä»¥ï¼Œæ‰ä¼šæœ‰æ­¤é™åˆ¶ã€‚

é‡å¤æ‰§è¡Œä¸Šä¸ªä¾‹å­ä¸­çš„æŸ¥è¯¢ï¼Œç”Ÿæˆçš„SQLå¦‚ä¸‹

```sql
select tb_1_.ID, tb_1_.NAME, tb_1_.EDITION, tb_1_.PRICE, tb_1_.STORE_ID
from BOOK tb_1_
inner join BOOK_STORE tb_2_
    on tb_1_.STORE_ID = tb_2_.ID
where
        tb_2_.NAME ilike ? /* %manning% */
    and
        exists(
            select
                1
            from AUTHOR tb_3_
            inner join BOOK_AUTHOR_MAPPING tb_4_
                on tb_3_.ID = tb_4_.AUTHOR_ID
            where
                    tb_1_.ID = tb_4_.BOOK_ID
                and
                    (
                        tb_3_.FIRST_NAME ilike ? /* %a% */
                    /* highlight-next-line */
                    or
                        tb_3_.LAST_NAME ilike ? /* %a% */
                    )
        )
```

ä¸éš¾å‘ç°ï¼Œå¤šå±æ€§æ˜ å°„å°±æ˜¯é€»è¾‘æˆ–ã€‚
