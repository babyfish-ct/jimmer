---
sidebar_position: 1  
title: Reason
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

import ImmutableOtherBenefit from '../../_shared/immutable-other-benefit.md';

Unlike other ORMs, Jimmer uses immutable objects as entity objects.

## Motivation

### Forbid circular references 

ORMs are often accompanied by a very headache problem: circular references.

-   Data structures containing circular references cannot be simply JSON serialized, which is a fatal flaw for HTTP API design.

-   In fact, this problem can be solved, for example, advanced features of JSON serialization libraries *(such as [Jackson](https://github.com/FasterXML/jackson))* can serialize data structures containing circular references. But this is meaningless, because the serialized result contains special extended content, which cannot be understood by client programming languages.

As an ORM, Jimmer of course allows users to define bidirectional associations between entity types, which is a powerful capability of ORM.

However, when instantiating objects, once the developer has determined the type of the aggregate root, the data structure created can only be a unidirectional tree with the aggregate root object as the starting point.

That is, bidirectional associations can be defined between entity types, keeping the possibilities of both directions. When instantiating objects, choose to use one of the association directions according to business characteristics.

:::tip
Jimmer entity-related data structures never contain circular references, so they can be directly involved in JSON serialization and then transmitted via HTTP protocols, while ensuring the simplicity of HTTP transmitted data to ensure that any programming language can understand.

This brings great simplification to application development.
:::

### Demo

<Tabs groupId="language">
<TabItem value="java" label="Java">  

```java
TreeNode aggregateRoot = TreeNodeDraft.$
    .produce(aggregateRootDraft ->
        aggregateRootDraft
            .setName("Aggregate root") 
            .addIntoChildNodes(childDraft ->
                childDraft
                    .setName("Child")
                    // Throw CircularReferenceException
                    // highlight-next-line 
                    .setParent(aggregateRootDraft)
            )
    );
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin
val aggregateRoot = new(TreeNode::class).by {

    val that = this

    name = "Aggregate root"
    childNodes().addBy {
        name = "Child"
        // Throw CircularReferenceException
        // highlight-next-line
        parent = that 
    }
}
```

</TabItem> 
</Tabs>

:::info
The above code uses an interface called `TreeNode`, which is the interface type automatically generated by Jimmer based on the user-defined type `TreeNode`.

Readers can ignore this auto-generated interface for now, later documentation [Draft](../draft) will introduce it.
:::


:::tip
This code will cause an exception: org.babyfish.jimmer.CircularReferenceException.

Although developers can define bidirectional associations between entity types, they cannot create bidirectional associations between entity objects. This behavior is explicitly prohibited.

It can be seen that Jimmer prevents users from creating data structures with circular references.

Jimmer objects are immutable objects. Users can neither build circular references when creating objects, nor form circular references through subsequent modifications. This quality will be preserved forever.
:::


## Other benefits

In addition to ensuring that there are absolutely no circular references between entity objects:

<ImmutableOtherBenefit/>
